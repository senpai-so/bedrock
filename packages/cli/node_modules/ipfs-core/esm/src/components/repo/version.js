import { withTimeoutOption } from 'ipfs-core-utils/with-timeout-option';
import { repoVersion } from 'ipfs-repo/constants';
export function createVersion({repo}) {
  async function version(options = {}) {
    try {
      await repo._checkInitialized(options);
    } catch (err) {
      const match = [
        /Key not found in database \[\/version\]/,
        /ENOENT/,
        /repo is not initialized yet/
      ].some(m => {
        return m.test(err.message);
      });
      if (match) {
        return repoVersion;
      }
      throw err;
    }
    return repo.version.get();
  }
  return withTimeoutOption(version);
}