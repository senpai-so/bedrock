import * as dagPB from '@ipld/dag-pb';
import { withTimeoutOption } from 'ipfs-core-utils/with-timeout-option';
import { createGet } from './get.js';
export function createStat({repo, preload}) {
  const get = createGet({
    repo,
    preload
  });
  async function stat(cid, options = {}) {
    const node = await get(cid, options);
    const serialized = dagPB.encode(node);
    const blockSize = serialized.length;
    const linkLength = node.Links.reduce((a, l) => a + (l.Tsize || 0), 0);
    return {
      Hash: cid,
      NumLinks: node.Links.length,
      BlockSize: blockSize,
      LinksSize: blockSize - (node.Data || []).length,
      DataSize: (node.Data || []).length,
      CumulativeSize: blockSize + linkLength
    };
  }
  return withTimeoutOption(stat);
}