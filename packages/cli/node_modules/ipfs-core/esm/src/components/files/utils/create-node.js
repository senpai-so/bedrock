import { UnixFS } from 'ipfs-unixfs';
import * as dagPB from '@ipld/dag-pb';
import { CID } from 'multiformats/cid';
export async function createNode(context, type, options) {
  const metadata = new UnixFS({
    type,
    mode: options.mode,
    mtime: options.mtime
  });
  const hasher = await context.hashers.getHasher(options.hashAlg);
  const node = {
    Data: metadata.marshal(),
    Links: []
  };
  const buf = dagPB.encode(node);
  const hash = await hasher.digest(buf);
  const cid = CID.create(options.cidVersion, dagPB.code, hash);
  if (options.flush) {
    await context.repo.blocks.put(cid, buf);
  }
  return {
    cid,
    node
  };
}