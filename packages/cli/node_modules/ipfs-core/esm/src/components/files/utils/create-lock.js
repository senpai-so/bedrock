import mortice from 'mortice';
let lock;
export function createLock(repoOwner = false) {
  if (lock) {
    return lock;
  }
  const mutex = mortice({ singleProcess: repoOwner });
  lock = {
    readLock: func => {
      return async (...args) => {
        const releaseLock = await mutex.readLock();
        try {
          return await func.apply(null, args);
        } finally {
          releaseLock();
        }
      };
    },
    writeLock: func => {
      return async (...args) => {
        const releaseLock = await mutex.writeLock();
        try {
          return await func.apply(null, args);
        } finally {
          releaseLock();
        }
      };
    }
  };
  return lock;
}