import drain from 'it-drain';
import { notFoundError } from 'datastore-core/errors';
import debug from 'debug';
const log = Object.assign(debug('ipfs:ipns:dht-datastore'), { error: debug('ipfs:ipns:dht-datastore:error') });
export class DHTDatastore {
  constructor(dht) {
    this._dht = dht;
  }
  async put(key, value) {
    try {
      await drain(this._dht.put(key, value));
    } catch (err) {
      log.error(err);
      throw err;
    }
  }
  async get(key) {
    for await (const event of this._dht.get(key)) {
      if (event.name === 'VALUE') {
        return event.value;
      }
    }
    throw notFoundError();
  }
}