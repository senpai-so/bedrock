(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.IpfsRepoMigrations = factory()}(typeof self !== 'undefined' ? self : this, function () {
var IpfsRepoMigrations=(()=>{var xs=Object.create;var mt=Object.defineProperty;var vs=Object.getOwnPropertyDescriptor;var Es=Object.getOwnPropertyNames;var Cs=Object.getPrototypeOf,As=Object.prototype.hasOwnProperty;var Hr=t=>mt(t,"__esModule",{value:!0});var A=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),M=(t,e)=>{Hr(t);for(var r in e)mt(t,r,{get:e[r],enumerable:!0})},_s=(t,e,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Es(e))!As.call(t,n)&&n!=="default"&&mt(t,n,{get:()=>e[n],enumerable:!(r=vs(e,n))||r.enumerable});return t},ce=t=>_s(Hr(mt(t!=null?xs(Cs(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var bn=A((ff,wn)=>{var De=1e3,Ue=De*60,Le=Ue*60,Ee=Le*24,Na=Ee*7,Ia=Ee*365.25;wn.exports=function(t,e){e=e||{};var r=typeof t;if(r==="string"&&t.length>0)return Fa(t);if(r==="number"&&isFinite(t))return e.long?Ua(t):Da(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function Fa(t){if(t=String(t),!(t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!!e){var r=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*Ia;case"weeks":case"week":case"w":return r*Na;case"days":case"day":case"d":return r*Ee;case"hours":case"hour":case"hrs":case"hr":case"h":return r*Le;case"minutes":case"minute":case"mins":case"min":case"m":return r*Ue;case"seconds":case"second":case"secs":case"sec":case"s":return r*De;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function Da(t){var e=Math.abs(t);return e>=Ee?Math.round(t/Ee)+"d":e>=Le?Math.round(t/Le)+"h":e>=Ue?Math.round(t/Ue)+"m":e>=De?Math.round(t/De)+"s":t+"ms"}function Ua(t){var e=Math.abs(t);return e>=Ee?Et(t,e,Ee,"day"):e>=Le?Et(t,e,Le,"hour"):e>=Ue?Et(t,e,Ue,"minute"):e>=De?Et(t,e,De,"second"):t+" ms"}function Et(t,e,r,n){var o=e>=r*1.5;return Math.round(t/r)+" "+n+(o?"s":"")}});var vn=A((lf,xn)=>{function La(t){r.debug=r,r.default=r,r.coerce=c,r.disable=i,r.enable=o,r.enabled=s,r.humanize=bn(),r.destroy=f,Object.keys(t).forEach(u=>{r[u]=t[u]}),r.names=[],r.skips=[],r.formatters={};function e(u){let d=0;for(let m=0;m<u.length;m++)d=(d<<5)-d+u.charCodeAt(m),d|=0;return r.colors[Math.abs(d)%r.colors.length]}r.selectColor=e;function r(u){let d,m=null,b,w;function E(...S){if(!E.enabled)return;let T=E,F=Number(new Date),V=F-(d||F);T.diff=V,T.prev=d,T.curr=F,d=F,S[0]=r.coerce(S[0]),typeof S[0]!="string"&&S.unshift("%O");let I=0;S[0]=S[0].replace(/%([a-zA-Z%])/g,(G,O)=>{if(G==="%%")return"%";I++;let W=r.formatters[O];if(typeof W=="function"){let je=S[I];G=W.call(T,je),S.splice(I,1),I--}return G}),r.formatArgs.call(T,S),(T.log||r.log).apply(T,S)}return E.namespace=u,E.useColors=r.useColors(),E.color=r.selectColor(u),E.extend=n,E.destroy=r.destroy,Object.defineProperty(E,"enabled",{enumerable:!0,configurable:!1,get:()=>m!==null?m:(b!==r.namespaces&&(b=r.namespaces,w=r.enabled(u)),w),set:S=>{m=S}}),typeof r.init=="function"&&r.init(E),E}function n(u,d){let m=r(this.namespace+(typeof d=="undefined"?":":d)+u);return m.log=this.log,m}function o(u){r.save(u),r.namespaces=u,r.names=[],r.skips=[];let d,m=(typeof u=="string"?u:"").split(/[\s,]+/),b=m.length;for(d=0;d<b;d++)!m[d]||(u=m[d].replace(/\*/g,".*?"),u[0]==="-"?r.skips.push(new RegExp("^"+u.substr(1)+"$")):r.names.push(new RegExp("^"+u+"$")))}function i(){let u=[...r.names.map(a),...r.skips.map(a).map(d=>"-"+d)].join(",");return r.enable(""),u}function s(u){if(u[u.length-1]==="*")return!0;let d,m;for(d=0,m=r.skips.length;d<m;d++)if(r.skips[d].test(u))return!1;for(d=0,m=r.names.length;d<m;d++)if(r.names[d].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function c(u){return u instanceof Error?u.stack||u.message:u}function f(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}xn.exports=La});var At=A(($,Ct)=>{$.formatArgs=Ma;$.save=$a;$.load=za;$.useColors=Oa;$.storage=Ra();$.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();$.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Oa(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Ma(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+Ct.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;t.splice(1,0,e,"color: inherit");let r=0,n=0;t[0].replace(/%[a-zA-Z%]/g,o=>{o!=="%%"&&(r++,o==="%c"&&(n=r))}),t.splice(n,0,e)}$.log=console.debug||console.log||(()=>{});function $a(t){try{t?$.storage.setItem("debug",t):$.storage.removeItem("debug")}catch(e){}}function za(){let t;try{t=$.storage.getItem("debug")}catch(e){}return!t&&typeof process!="undefined"&&"env"in process&&(t=process.env.DEBUG),t}function Ra(){try{return localStorage}catch(t){}}Ct.exports=vn()($);var{formatters:Pa}=Ct.exports;Pa.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var cr=A((df,En)=>{"use strict";var qa=async t=>{let e=0;for await(let r of t)e++;return e};En.exports=qa});var qo=A((Xl,Po)=>{"use strict";Po.exports=_c;function _c(t,e){for(var r=new Array(arguments.length-1),n=0,o=2,i=!0;o<arguments.length;)r[n++]=arguments[o++];return new Promise(function(a,c){r[n]=function(u){if(i)if(i=!1,u)c(u);else{for(var d=new Array(arguments.length-1),m=0;m<d.length;)d[m++]=arguments[m];a.apply(null,d)}};try{t.apply(e||null,r)}catch(f){i&&(i=!1,c(f))}})}});var Wo=A(Go=>{"use strict";var Ot=Go;Ot.length=function(e){var r=e.length;if(!r)return 0;for(var n=0;--r%4>1&&e.charAt(r)==="=";)++n;return Math.ceil(e.length*3)/4-n};var Pe=new Array(64),Ho=new Array(123);for(ee=0;ee<64;)Ho[Pe[ee]=ee<26?ee+65:ee<52?ee+71:ee<62?ee-4:ee-59|43]=ee++;var ee;Ot.encode=function(e,r,n){for(var o=null,i=[],s=0,a=0,c;r<n;){var f=e[r++];switch(a){case 0:i[s++]=Pe[f>>2],c=(f&3)<<4,a=1;break;case 1:i[s++]=Pe[c|f>>4],c=(f&15)<<2,a=2;break;case 2:i[s++]=Pe[c|f>>6],i[s++]=Pe[f&63],a=0;break}s>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,i)),s=0)}return a&&(i[s++]=Pe[c],i[s++]=61,a===1&&(i[s++]=61)),o?(s&&o.push(String.fromCharCode.apply(String,i.slice(0,s))),o.join("")):String.fromCharCode.apply(String,i.slice(0,s))};var Vo="invalid encoding";Ot.decode=function(e,r,n){for(var o=n,i=0,s,a=0;a<e.length;){var c=e.charCodeAt(a++);if(c===61&&i>1)break;if((c=Ho[c])===void 0)throw Error(Vo);switch(i){case 0:s=c,i=1;break;case 1:r[n++]=s<<2|(c&48)>>4,s=c,i=2;break;case 2:r[n++]=(s&15)<<4|(c&60)>>2,s=c,i=3;break;case 3:r[n++]=(s&3)<<6|c,i=0;break}}if(i===1)throw Error(Vo);return n-o};Ot.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var Jo=A((Ql,Ko)=>{"use strict";Ko.exports=Mt;function Mt(){this._listeners={}}Mt.prototype.on=function(e,r,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:r,ctx:n||this}),this};Mt.prototype.off=function(e,r){if(e===void 0)this._listeners={};else if(r===void 0)this._listeners[e]=[];else for(var n=this._listeners[e],o=0;o<n.length;)n[o].fn===r?n.splice(o,1):++o;return this};Mt.prototype.emit=function(e){var r=this._listeners[e];if(r){for(var n=[],o=1;o<arguments.length;)n.push(arguments[o++]);for(o=0;o<r.length;)r[o].fn.apply(r[o++].ctx,n)}return this}});var ri=A((ed,ti)=>{"use strict";ti.exports=Yo(Yo);function Yo(t){return typeof Float32Array!="undefined"?function(){var e=new Float32Array([-0]),r=new Uint8Array(e.buffer),n=r[3]===128;function o(c,f,u){e[0]=c,f[u]=r[0],f[u+1]=r[1],f[u+2]=r[2],f[u+3]=r[3]}function i(c,f,u){e[0]=c,f[u]=r[3],f[u+1]=r[2],f[u+2]=r[1],f[u+3]=r[0]}t.writeFloatLE=n?o:i,t.writeFloatBE=n?i:o;function s(c,f){return r[0]=c[f],r[1]=c[f+1],r[2]=c[f+2],r[3]=c[f+3],e[0]}function a(c,f){return r[3]=c[f],r[2]=c[f+1],r[1]=c[f+2],r[0]=c[f+3],e[0]}t.readFloatLE=n?s:a,t.readFloatBE=n?a:s}():function(){function e(n,o,i,s){var a=o<0?1:0;if(a&&(o=-o),o===0)n(1/o>0?0:2147483648,i,s);else if(isNaN(o))n(2143289344,i,s);else if(o>34028234663852886e22)n((a<<31|2139095040)>>>0,i,s);else if(o<11754943508222875e-54)n((a<<31|Math.round(o/1401298464324817e-60))>>>0,i,s);else{var c=Math.floor(Math.log(o)/Math.LN2),f=Math.round(o*Math.pow(2,-c)*8388608)&8388607;n((a<<31|c+127<<23|f)>>>0,i,s)}}t.writeFloatLE=e.bind(null,Xo),t.writeFloatBE=e.bind(null,Zo);function r(n,o,i){var s=n(o,i),a=(s>>31)*2+1,c=s>>>23&255,f=s&8388607;return c===255?f?NaN:a*(1/0):c===0?a*1401298464324817e-60*f:a*Math.pow(2,c-150)*(f+8388608)}t.readFloatLE=r.bind(null,Qo),t.readFloatBE=r.bind(null,ei)}(),typeof Float64Array!="undefined"?function(){var e=new Float64Array([-0]),r=new Uint8Array(e.buffer),n=r[7]===128;function o(c,f,u){e[0]=c,f[u]=r[0],f[u+1]=r[1],f[u+2]=r[2],f[u+3]=r[3],f[u+4]=r[4],f[u+5]=r[5],f[u+6]=r[6],f[u+7]=r[7]}function i(c,f,u){e[0]=c,f[u]=r[7],f[u+1]=r[6],f[u+2]=r[5],f[u+3]=r[4],f[u+4]=r[3],f[u+5]=r[2],f[u+6]=r[1],f[u+7]=r[0]}t.writeDoubleLE=n?o:i,t.writeDoubleBE=n?i:o;function s(c,f){return r[0]=c[f],r[1]=c[f+1],r[2]=c[f+2],r[3]=c[f+3],r[4]=c[f+4],r[5]=c[f+5],r[6]=c[f+6],r[7]=c[f+7],e[0]}function a(c,f){return r[7]=c[f],r[6]=c[f+1],r[5]=c[f+2],r[4]=c[f+3],r[3]=c[f+4],r[2]=c[f+5],r[1]=c[f+6],r[0]=c[f+7],e[0]}t.readDoubleLE=n?s:a,t.readDoubleBE=n?a:s}():function(){function e(n,o,i,s,a,c){var f=s<0?1:0;if(f&&(s=-s),s===0)n(0,a,c+o),n(1/s>0?0:2147483648,a,c+i);else if(isNaN(s))n(0,a,c+o),n(2146959360,a,c+i);else if(s>17976931348623157e292)n(0,a,c+o),n((f<<31|2146435072)>>>0,a,c+i);else{var u;if(s<22250738585072014e-324)u=s/5e-324,n(u>>>0,a,c+o),n((f<<31|u/4294967296)>>>0,a,c+i);else{var d=Math.floor(Math.log(s)/Math.LN2);d===1024&&(d=1023),u=s*Math.pow(2,-d),n(u*4503599627370496>>>0,a,c+o),n((f<<31|d+1023<<20|u*1048576&1048575)>>>0,a,c+i)}}}t.writeDoubleLE=e.bind(null,Xo,0,4),t.writeDoubleBE=e.bind(null,Zo,4,0);function r(n,o,i,s,a){var c=n(s,a+o),f=n(s,a+i),u=(f>>31)*2+1,d=f>>>20&2047,m=4294967296*(f&1048575)+c;return d===2047?m?NaN:u*(1/0):d===0?u*5e-324*m:u*Math.pow(2,d-1075)*(m+4503599627370496)}t.readDoubleLE=r.bind(null,Qo,0,4),t.readDoubleBE=r.bind(null,ei,4,0)}(),t}function Xo(t,e,r){e[r]=t&255,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24}function Zo(t,e,r){e[r]=t>>>24,e[r+1]=t>>>16&255,e[r+2]=t>>>8&255,e[r+3]=t&255}function Qo(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function ei(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}});var ni=A((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(t){}return null}});var ii=A(oi=>{"use strict";var xr=oi;xr.length=function(e){for(var r=0,n=0,o=0;o<e.length;++o)n=e.charCodeAt(o),n<128?r+=1:n<2048?r+=2:(n&64512)==55296&&(e.charCodeAt(o+1)&64512)==56320?(++o,r+=4):r+=3;return r};xr.read=function(e,r,n){var o=n-r;if(o<1)return"";for(var i=null,s=[],a=0,c;r<n;)c=e[r++],c<128?s[a++]=c:c>191&&c<224?s[a++]=(c&31)<<6|e[r++]&63:c>239&&c<365?(c=((c&7)<<18|(e[r++]&63)<<12|(e[r++]&63)<<6|e[r++]&63)-65536,s[a++]=55296+(c>>10),s[a++]=56320+(c&1023)):s[a++]=(c&15)<<12|(e[r++]&63)<<6|e[r++]&63,a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,s.slice(0,a))),i.join("")):String.fromCharCode.apply(String,s.slice(0,a))};xr.write=function(e,r,n){for(var o=n,i,s,a=0;a<e.length;++a)i=e.charCodeAt(a),i<128?r[n++]=i:i<2048?(r[n++]=i>>6|192,r[n++]=i&63|128):(i&64512)==55296&&((s=e.charCodeAt(a+1))&64512)==56320?(i=65536+((i&1023)<<10)+(s&1023),++a,r[n++]=i>>18|240,r[n++]=i>>12&63|128,r[n++]=i>>6&63|128,r[n++]=i&63|128):(r[n++]=i>>12|224,r[n++]=i>>6&63|128,r[n++]=i&63|128);return n-o}});var ai=A((rd,si)=>{"use strict";si.exports=Sc;function Sc(t,e,r){var n=r||8192,o=n>>>1,i=null,s=n;return function(c){if(c<1||c>o)return t(c);s+c>n&&(i=t(n),s=0);var f=e.call(i,s,s+=c);return s&7&&(s=(s|7)+1),f}}});var ui=A((nd,ci)=>{"use strict";ci.exports=N;var nt=be();function N(t,e){this.lo=t>>>0,this.hi=e>>>0}var Ce=N.zero=new N(0,0);Ce.toNumber=function(){return 0};Ce.zzEncode=Ce.zzDecode=function(){return this};Ce.length=function(){return 1};var Bc=N.zeroHash="\0\0\0\0\0\0\0\0";N.fromNumber=function(e){if(e===0)return Ce;var r=e<0;r&&(e=-e);var n=e>>>0,o=(e-n)/4294967296>>>0;return r&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new N(n,o)};N.from=function(e){if(typeof e=="number")return N.fromNumber(e);if(nt.isString(e))if(nt.Long)e=nt.Long.fromString(e);else return N.fromNumber(parseInt(e,10));return e.low||e.high?new N(e.low>>>0,e.high>>>0):Ce};N.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var r=~this.lo+1>>>0,n=~this.hi>>>0;return r||(n=n+1>>>0),-(r+n*4294967296)}return this.lo+this.hi*4294967296};N.prototype.toLong=function(e){return nt.Long?new nt.Long(this.lo|0,this.hi|0,Boolean(e)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(e)}};var we=String.prototype.charCodeAt;N.fromHash=function(e){return e===Bc?Ce:new N((we.call(e,0)|we.call(e,1)<<8|we.call(e,2)<<16|we.call(e,3)<<24)>>>0,(we.call(e,4)|we.call(e,5)<<8|we.call(e,6)<<16|we.call(e,7)<<24)>>>0)};N.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};N.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};N.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};N.prototype.length=function(){var e=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?r===0?e<16384?e<128?1:2:e<2097152?3:4:r<16384?r<128?5:6:r<2097152?7:8:n<128?9:10}});var be=A(vr=>{"use strict";var g=vr;g.asPromise=qo();g.base64=Wo();g.EventEmitter=Jo();g.float=ri();g.inquire=ni();g.utf8=ii();g.pool=ai();g.LongBits=ui();g.isNode=Boolean(typeof globalThis!="undefined"&&globalThis&&globalThis.process&&globalThis.process.versions&&globalThis.process.versions.node);g.global=g.isNode&&globalThis||typeof window!="undefined"&&window||typeof self!="undefined"&&self||vr;g.emptyArray=Object.freeze?Object.freeze([]):[];g.emptyObject=Object.freeze?Object.freeze({}):{};g.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};g.isString=function(e){return typeof e=="string"||e instanceof String};g.isObject=function(e){return e&&typeof e=="object"};g.isset=g.isSet=function(e,r){var n=e[r];return n!=null&&e.hasOwnProperty(r)?typeof n!="object"||(Array.isArray(n)?n.length:Object.keys(n).length)>0:!1};g.Buffer=function(){try{var t=g.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(e){return null}}();g._Buffer_from=null;g._Buffer_allocUnsafe=null;g.newBuffer=function(e){return typeof e=="number"?g.Buffer?g._Buffer_allocUnsafe(e):new g.Array(e):g.Buffer?g._Buffer_from(e):typeof Uint8Array=="undefined"?e:new Uint8Array(e)};g.Array=typeof Uint8Array!="undefined"?Uint8Array:Array;g.Long=g.global.dcodeIO&&g.global.dcodeIO.Long||g.global.Long||g.inquire("long");g.key2Re=/^true|false|0|1$/;g.key32Re=/^-?(?:0|[1-9][0-9]*)$/;g.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;g.longToHash=function(e){return e?g.LongBits.from(e).toHash():g.LongBits.zeroHash};g.longFromHash=function(e,r){var n=g.LongBits.fromHash(e);return g.Long?g.Long.fromBits(n.lo,n.hi,r):n.toNumber(Boolean(r))};function fi(t,e,r){for(var n=Object.keys(e),o=0;o<n.length;++o)(t[n[o]]===void 0||!r)&&(t[n[o]]=e[n[o]]);return t}g.merge=fi;g.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function li(t){function e(r,n){if(!(this instanceof e))return new e(r,n);Object.defineProperty(this,"message",{get:function(){return r}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),n&&fi(this,n)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return t}}),e.prototype.toString=function(){return this.name+": "+this.message},e}g.newError=li;g.ProtocolError=li("ProtocolError");g.oneOfGetter=function(e){for(var r={},n=0;n<e.length;++n)r[e[n]]=1;return function(){for(var o=Object.keys(this),i=o.length-1;i>-1;--i)if(r[o[i]]===1&&this[o[i]]!==void 0&&this[o[i]]!==null)return o[i]}};g.oneOfSetter=function(e){return function(r){for(var n=0;n<e.length;++n)e[n]!==r&&delete this[e[n]]}};g.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};g._configure=function(){var t=g.Buffer;if(!t){g._Buffer_from=g._Buffer_allocUnsafe=null;return}g._Buffer_from=t.from!==Uint8Array.from&&t.from||function(r,n){return new t(r,n)},g._Buffer_allocUnsafe=t.allocUnsafe||function(r){return new t(r)}}});var Tr=A((id,mi)=>{"use strict";mi.exports=v;var Y=be(),Er,$t=Y.LongBits,di=Y.base64,hi=Y.utf8;function ot(t,e,r){this.fn=t,this.len=e,this.next=void 0,this.val=r}function Cr(){}function Tc(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function v(){this.len=0,this.head=new ot(Cr,0,0),this.tail=this.head,this.states=null}var pi=function(){return Y.Buffer?function(){return(v.create=function(){return new Er})()}:function(){return new v}};v.create=pi();v.alloc=function(e){return new Y.Array(e)};Y.Array!==Array&&(v.alloc=Y.pool(v.alloc,Y.Array.prototype.subarray));v.prototype._push=function(e,r,n){return this.tail=this.tail.next=new ot(e,r,n),this.len+=r,this};function Ar(t,e,r){e[r]=t&255}function jc(t,e,r){for(;t>127;)e[r++]=t&127|128,t>>>=7;e[r]=t}function _r(t,e){this.len=t,this.next=void 0,this.val=e}_r.prototype=Object.create(ot.prototype);_r.prototype.fn=jc;v.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new _r((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};v.prototype.int32=function(e){return e<0?this._push(Sr,10,$t.fromNumber(e)):this.uint32(e)};v.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function Sr(t,e,r){for(;t.hi;)e[r++]=t.lo&127|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)e[r++]=t.lo&127|128,t.lo=t.lo>>>7;e[r++]=t.lo}v.prototype.uint64=function(e){var r=$t.from(e);return this._push(Sr,r.length(),r)};v.prototype.int64=v.prototype.uint64;v.prototype.sint64=function(e){var r=$t.from(e).zzEncode();return this._push(Sr,r.length(),r)};v.prototype.bool=function(e){return this._push(Ar,1,e?1:0)};function Br(t,e,r){e[r]=t&255,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24}v.prototype.fixed32=function(e){return this._push(Br,4,e>>>0)};v.prototype.sfixed32=v.prototype.fixed32;v.prototype.fixed64=function(e){var r=$t.from(e);return this._push(Br,4,r.lo)._push(Br,4,r.hi)};v.prototype.sfixed64=v.prototype.fixed64;v.prototype.float=function(e){return this._push(Y.float.writeFloatLE,4,e)};v.prototype.double=function(e){return this._push(Y.float.writeDoubleLE,8,e)};var kc=Y.Array.prototype.set?function(e,r,n){r.set(e,n)}:function(e,r,n){for(var o=0;o<e.length;++o)r[n+o]=e[o]};v.prototype.bytes=function(e){var r=e.length>>>0;if(!r)return this._push(Ar,1,0);if(Y.isString(e)){var n=v.alloc(r=di.length(e));di.decode(e,n,0),e=n}return this.uint32(r)._push(kc,r,e)};v.prototype.string=function(e){var r=hi.length(e);return r?this.uint32(r)._push(hi.write,r,e):this._push(Ar,1,0)};v.prototype.fork=function(){return this.states=new Tc(this),this.head=this.tail=new ot(Cr,0,0),this.len=0,this};v.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new ot(Cr,0,0),this.len=0),this};v.prototype.ldelim=function(){var e=this.head,r=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=r,this.len+=n),this};v.prototype.finish=function(){for(var e=this.head.next,r=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,r,n),n+=e.len,e=e.next;return r};v._configure=function(t){Er=t,v.create=pi(),Er._configure()}});var wi=A((sd,yi)=>{"use strict";yi.exports=se;var gi=Tr();(se.prototype=Object.create(gi.prototype)).constructor=se;var xe=be();function se(){gi.call(this)}se._configure=function(){se.alloc=xe._Buffer_allocUnsafe,se.writeBytesBuffer=xe.Buffer&&xe.Buffer.prototype instanceof Uint8Array&&xe.Buffer.prototype.set.name==="set"?function(e,r,n){r.set(e,n)}:function(e,r,n){if(e.copy)e.copy(r,n,0,e.length);else for(var o=0;o<e.length;)r[n++]=e[o++]}};se.prototype.bytes=function(e){xe.isString(e)&&(e=xe._Buffer_from(e,"base64"));var r=e.length>>>0;return this.uint32(r),r&&this._push(se.writeBytesBuffer,r,e),this};function Nc(t,e,r){t.length<40?xe.utf8.write(t,e,r):e.utf8Write?e.utf8Write(t,r):e.write(t,r)}se.prototype.string=function(e){var r=xe.Buffer.byteLength(e);return this.uint32(r),r&&this._push(Nc,r,e),this};se._configure()});var Nr=A((ad,Ci)=>{"use strict";Ci.exports=j;var ae=be(),jr,bi=ae.LongBits,Ic=ae.utf8;function te(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function j(t){this.buf=t,this.pos=0,this.len=t.length}var xi=typeof Uint8Array!="undefined"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new j(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new j(e);throw Error("illegal buffer")},vi=function(){return ae.Buffer?function(r){return(j.create=function(o){return ae.Buffer.isBuffer(o)?new jr(o):xi(o)})(r)}:xi};j.create=vi();j.prototype._slice=ae.Array.prototype.subarray||ae.Array.prototype.slice;j.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,te(this,10);return e}}();j.prototype.int32=function(){return this.uint32()|0};j.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function kr(){var t=new bi(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw te(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,t}if(this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw te(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}j.prototype.bool=function(){return this.uint32()!==0};function zt(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}j.prototype.fixed32=function(){if(this.pos+4>this.len)throw te(this,4);return zt(this.buf,this.pos+=4)};j.prototype.sfixed32=function(){if(this.pos+4>this.len)throw te(this,4);return zt(this.buf,this.pos+=4)|0};function Ei(){if(this.pos+8>this.len)throw te(this,8);return new bi(zt(this.buf,this.pos+=4),zt(this.buf,this.pos+=4))}j.prototype.float=function(){if(this.pos+4>this.len)throw te(this,4);var e=ae.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};j.prototype.double=function(){if(this.pos+8>this.len)throw te(this,4);var e=ae.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};j.prototype.bytes=function(){var e=this.uint32(),r=this.pos,n=this.pos+e;if(n>this.len)throw te(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(r,n):r===n?new this.buf.constructor(0):this._slice.call(this.buf,r,n)};j.prototype.string=function(){var e=this.bytes();return Ic.read(e,0,e.length)};j.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw te(this,e);this.pos+=e}else do if(this.pos>=this.len)throw te(this);while(this.buf[this.pos++]&128);return this};j.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!=4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this};j._configure=function(t){jr=t,j.create=vi(),jr._configure();var e=ae.Long?"toLong":"toNumber";ae.merge(j.prototype,{int64:function(){return kr.call(this)[e](!1)},uint64:function(){return kr.call(this)[e](!0)},sint64:function(){return kr.call(this).zzDecode()[e](!1)},fixed64:function(){return Ei.call(this)[e](!0)},sfixed64:function(){return Ei.call(this)[e](!1)}})}});var Bi=A((cd,Si)=>{"use strict";Si.exports=Ae;var Ai=Nr();(Ae.prototype=Object.create(Ai.prototype)).constructor=Ae;var _i=be();function Ae(t){Ai.call(this,t)}Ae._configure=function(){_i.Buffer&&(Ae.prototype._slice=_i.Buffer.prototype.slice)};Ae.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Ae._configure()});var ji=A((ud,Ti)=>{"use strict";Ti.exports=it;var Ir=be();(it.prototype=Object.create(Ir.EventEmitter.prototype)).constructor=it;function it(t,e,r){if(typeof t!="function")throw TypeError("rpcImpl must be a function");Ir.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(r)}it.prototype.rpcCall=function t(e,r,n,o,i){if(!o)throw TypeError("request must be specified");var s=this;if(!i)return Ir.asPromise(t,s,e,r,n,o);if(!s.rpcImpl){setTimeout(function(){i(Error("already ended"))},0);return}try{return s.rpcImpl(e,r[s.requestDelimited?"encodeDelimited":"encode"](o).finish(),function(c,f){if(c)return s.emit("error",c,e),i(c);if(f===null){s.end(!0);return}if(!(f instanceof n))try{f=n[s.responseDelimited?"decodeDelimited":"decode"](f)}catch(u){return s.emit("error",u,e),i(u)}return s.emit("data",f,e),i(null,f)})}catch(a){s.emit("error",a,e),setTimeout(function(){i(a)},0);return}};it.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var Ni=A(ki=>{"use strict";var Fc=ki;Fc.Service=ji()});var Fi=A((ld,Ii)=>{"use strict";Ii.exports={}});var Li=A(Ui=>{"use strict";var L=Ui;L.build="minimal";L.Writer=Tr();L.BufferWriter=wi();L.Reader=Nr();L.BufferReader=Bi();L.util=be();L.rpc=Ni();L.roots=Fi();L.configure=Di;function Di(){L.util._configure(),L.Writer._configure(L.BufferWriter),L.Reader._configure(L.BufferReader)}Di()});var Mi=A((hd,Oi)=>{"use strict";Oi.exports=Li()});var Pi=A((gd,Ri)=>{Fr.BASE=2166136261;function Fr(t){for(var e=Fr.BASE,r=0,n=t.length;r<n;r++)e^=t.charCodeAt(r),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24);return e>>>0}Ri.exports=Fr});var Vi=A((yd,Hi)=>{Hi.exports=Dr;var qi=128,Uc=127,Lc=~Uc,Oc=Math.pow(2,31);function Dr(t,e,r){if(Number.MAX_SAFE_INTEGER&&t>Number.MAX_SAFE_INTEGER)throw Dr.bytes=0,new RangeError("Could not encode varint");e=e||[],r=r||0;for(var n=r;t>=Oc;)e[r++]=t&255|qi,t/=128;for(;t&Lc;)e[r++]=t&255|qi,t>>>=7;return e[r]=t|0,Dr.bytes=r-n+1,e}});var Ki=A((wd,Wi)=>{Wi.exports=Ur;var Mc=128,Gi=127;function Ur(t,e){var r=0,e=e||0,n=0,o=e,i,s=t.length;do{if(o>=s||n>49)throw Ur.bytes=0,new RangeError("Could not decode varint");i=t[o++],r+=n<28?(i&Gi)<<n:(i&Gi)*Math.pow(2,n),n+=7}while(i>=Mc);return Ur.bytes=o-e,r}});var Yi=A((bd,Ji)=>{var $c=Math.pow(2,7),zc=Math.pow(2,14),Rc=Math.pow(2,21),Pc=Math.pow(2,28),qc=Math.pow(2,35),Hc=Math.pow(2,42),Vc=Math.pow(2,49),Gc=Math.pow(2,56),Wc=Math.pow(2,63);Ji.exports=function(t){return t<$c?1:t<zc?2:t<Rc?3:t<Pc?4:t<qc?5:t<Hc?6:t<Vc?7:t<Gc?8:t<Wc?9:10}});var Zi=A((xd,Xi)=>{Xi.exports={encode:Vi(),decode:Ki(),encodingLength:Yi()}});var as=A((Gd,ss)=>{"use strict";function is(t,e){for(let r in e)Object.defineProperty(t,r,{value:e[r],enumerable:!0,configurable:!0});return t}function Qc(t,e,r){if(!t||typeof t=="string")throw new TypeError("Please pass an Error to err-code");r||(r={}),typeof e=="object"&&(r=e,e=""),e&&(r.code=e);try{return is(t,r)}catch(n){r.message=t.message,r.stack=t.stack;let o=function(){};return o.prototype=Object.create(Object.getPrototypeOf(t)),is(new o,r)}}ss.exports=Qc});var fu={};M(fu,{errors:()=>H,getCurrentRepoVersion:()=>cu,getLatestMigrationVersion:()=>ws,migrate:()=>su,migrations:()=>uu,revert:()=>au});var Ss=Gr,Vr=128,Bs=127,Ts=~Bs,js=Math.pow(2,31);function Gr(t,e,r){e=e||[],r=r||0;for(var n=r;t>=js;)e[r++]=t&255|Vr,t/=128;for(;t&Ts;)e[r++]=t&255|Vr,t>>>=7;return e[r]=t|0,Gr.bytes=r-n+1,e}var ks=Kt,Ns=128,Wr=127;function Kt(t,e){var r=0,e=e||0,n=0,o=e,i,s=t.length;do{if(o>=s)throw Kt.bytes=0,new RangeError("Could not decode varint");i=t[o++],r+=n<28?(i&Wr)<<n:(i&Wr)*Math.pow(2,n),n+=7}while(i>=Ns);return Kt.bytes=o-e,r}var Is=Math.pow(2,7),Fs=Math.pow(2,14),Ds=Math.pow(2,21),Us=Math.pow(2,28),Ls=Math.pow(2,35),Os=Math.pow(2,42),Ms=Math.pow(2,49),$s=Math.pow(2,56),zs=Math.pow(2,63),Rs=function(t){return t<Is?1:t<Fs?2:t<Ds?3:t<Us?4:t<Ls?5:t<Os?6:t<Ms?7:t<$s?8:t<zs?9:10},Ps={encode:Ss,decode:ks,encodingLength:Rs},qs=Ps,qe=qs;var He=t=>[qe.decode(t),qe.decode.bytes],ke=(t,e,r=0)=>(qe.encode(t,e,r),e),Ne=t=>qe.encodingLength(t);var pu=new Uint8Array(0);var Jr=(t,e)=>{if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(let r=0;r<t.byteLength;r++)if(t[r]!==e[r])return!1;return!0},ue=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")};var Yr=t=>new TextEncoder().encode(t),Xr=t=>new TextDecoder().decode(t);var gt=(t,e)=>{let r=e.byteLength,n=Ne(t),o=n+Ne(r),i=new Uint8Array(o+r);return ke(t,i,0),ke(r,i,n),i.set(e,o),new Ve(t,r,e,i)},Ie=t=>{let e=ue(t),[r,n]=He(e),[o,i]=He(e.subarray(n)),s=e.subarray(n+i);if(s.byteLength!==o)throw new Error("Incorrect length");return new Ve(r,o,s,e)},Qr=(t,e)=>t===e?!0:t.code===e.code&&t.size===e.size&&Jr(t.bytes,e.bytes),Ve=class{constructor(e,r,n,o){this.code=e,this.size=r,this.digest=n,this.bytes=o}};var Jt={};M(Jt,{base58btc:()=>ne,base58flickr:()=>Js});function Hs(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<t.length;o++){var i=t.charAt(o),s=i.charCodeAt(0);if(r[s]!==255)throw new TypeError(i+" is ambiguous");r[s]=o}var a=t.length,c=t.charAt(0),f=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(w){if(w instanceof Uint8Array||(ArrayBuffer.isView(w)?w=new Uint8Array(w.buffer,w.byteOffset,w.byteLength):Array.isArray(w)&&(w=Uint8Array.from(w))),!(w instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(w.length===0)return"";for(var E=0,S=0,T=0,F=w.length;T!==F&&w[T]===0;)T++,E++;for(var V=(F-T)*u+1>>>0,I=new Uint8Array(V);T!==F;){for(var X=w[T],G=0,O=V-1;(X!==0||G<S)&&O!==-1;O--,G++)X+=256*I[O]>>>0,I[O]=X%a>>>0,X=X/a>>>0;if(X!==0)throw new Error("Non-zero carry");S=G,T++}for(var W=V-S;W!==V&&I[W]===0;)W++;for(var je=c.repeat(E);W<V;++W)je+=t.charAt(I[W]);return je}function m(w){if(typeof w!="string")throw new TypeError("Expected String");if(w.length===0)return new Uint8Array;var E=0;if(w[E]!==" "){for(var S=0,T=0;w[E]===c;)S++,E++;for(var F=(w.length-E)*f+1>>>0,V=new Uint8Array(F);w[E];){var I=r[w.charCodeAt(E)];if(I===255)return;for(var X=0,G=F-1;(I!==0||X<T)&&G!==-1;G--,X++)I+=a*V[G]>>>0,V[G]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");T=X,E++}if(w[E]!==" "){for(var O=F-T;O!==F&&V[O]===0;)O++;for(var W=new Uint8Array(S+(F-O)),je=S;O!==F;)W[je++]=V[O++];return W}}}function b(w){var E=m(w);if(E)return E;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:m,decode:b}}var Vs=Hs,Gs=Vs,tn=Gs;var rn=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},nn=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseDecode=n}decode(e){if(typeof e=="string")switch(e[0]){case this.prefix:return this.baseDecode(e.slice(1));default:throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`)}else throw Error("Can only multibase decode strings")}or(e){return sn(this,e)}},on=class{constructor(e){this.decoders=e}or(e){return sn(this,e)}decode(e){let r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},sn=(t,e)=>new on({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}}),an=class{constructor(e,r,n,o){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new rn(e,r,n),this.decoder=new nn(e,r,o)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},yt=({name:t,prefix:e,encode:r,decode:n})=>new an(t,e,r,n),he=({prefix:t,name:e,alphabet:r})=>{let{encode:n,decode:o}=tn(r,e);return yt({prefix:t,name:e,encode:n,decode:i=>ue(o(i))})},Ws=(t,e,r,n)=>{let o={};for(let u=0;u<e.length;++u)o[e[u]]=u;let i=t.length;for(;t[i-1]==="=";)--i;let s=new Uint8Array(i*r/8|0),a=0,c=0,f=0;for(let u=0;u<i;++u){let d=o[t[u]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|d,a+=r,a>=8&&(a-=8,s[f++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return s},Ks=(t,e,r)=>{let n=e[e.length-1]==="=",o=(1<<r)-1,i="",s=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],s+=8;s>r;)s-=r,i+=e[o&a>>s];if(s&&(i+=e[o&a<<r-s]),n)for(;i.length*r&7;)i+="=";return i},B=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>yt({prefix:e,name:t,encode(o){return Ks(o,n,r)},decode(o){return Ws(o,n,r,t)}});var ne=he({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Js=he({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Yt={};M(Yt,{base32:()=>D,base32hex:()=>Qs,base32hexpad:()=>ta,base32hexpadupper:()=>ra,base32hexupper:()=>ea,base32pad:()=>Xs,base32padupper:()=>Zs,base32upper:()=>Ys,base32z:()=>na});var D=B({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ys=B({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Xs=B({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Zs=B({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Qs=B({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ea=B({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ta=B({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ra=B({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),na=B({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var x=class{constructor(e,r,n,o){this.code=r,this.version=e,this.multihash=n,this.bytes=o,this.byteOffset=o.byteOffset,this.byteLength=o.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:bt,byteLength:bt,code:wt,version:wt,multihash:wt,bytes:wt,_baseCache:bt,asCID:bt})}toV0(){switch(this.version){case 0:return this;default:{let{code:e,multihash:r}=this;if(e!==Ge)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==aa)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return x.createV0(r)}}}toV1(){switch(this.version){case 0:{let{code:e,digest:r}=this.multihash,n=gt(e,r);return x.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&Qr(this.multihash,e.multihash)}toString(e){let{bytes:r,version:n,_baseCache:o}=this;switch(n){case 0:return ia(r,o,e||ne.encoder);default:return sa(r,o,e||D.encoder)}}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return ua(/^0\.0/,fa),!!(e&&(e[un]||e.asCID===e))}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof x)return e;if(e!=null&&e.asCID===e){let{version:r,code:n,multihash:o,bytes:i}=e;return new x(r,n,o,i||cn(r,n,o.bytes))}else if(e!=null&&e[un]===!0){let{version:r,multihash:n,code:o}=e,i=Ie(n);return x.create(r,o,i)}else return null}static create(e,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");switch(e){case 0:{if(r!==Ge)throw new Error(`Version 0 CID must use dag-pb (code: ${Ge}) block encoding`);return new x(e,r,n,n.bytes)}case 1:{let o=cn(e,r,n.bytes);return new x(e,r,n,o)}default:throw new Error("Invalid version")}}static createV0(e){return x.create(0,Ge,e)}static createV1(e,r){return x.create(1,e,r)}static decode(e){let[r,n]=x.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return r}static decodeFirst(e){let r=x.inspectBytes(e),n=r.size-r.multihashSize,o=ue(e.subarray(n,n+r.multihashSize));if(o.byteLength!==r.multihashSize)throw new Error("Incorrect length");let i=o.subarray(r.multihashSize-r.digestSize),s=new Ve(r.multihashCode,r.digestSize,i,o);return[r.version===0?x.createV0(s):x.createV1(r.codec,s),e.subarray(r.size)]}static inspectBytes(e){let r=0,n=()=>{let[d,m]=He(e.subarray(r));return r+=m,d},o=n(),i=Ge;if(o===18?(o=0,r=0):o===1&&(i=n()),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let s=r,a=n(),c=n(),f=r+c,u=f-s;return{version:o,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:f}}static parse(e,r){let[n,o]=oa(e,r),i=x.decode(o);return i._baseCache.set(n,e),i}},oa=(t,e)=>{switch(t[0]){case"Q":{let r=e||ne;return[ne.prefix,r.decode(`${ne.prefix}${t}`)]}case ne.prefix:{let r=e||ne;return[ne.prefix,r.decode(t)]}case D.prefix:{let r=e||D;return[D.prefix,r.decode(t)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[t[0],e.decode(t)]}}},ia=(t,e,r)=>{let{prefix:n}=r;if(n!==ne.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let o=e.get(n);if(o==null){let i=r.encode(t).slice(1);return e.set(n,i),i}else return o},sa=(t,e,r)=>{let{prefix:n}=r,o=e.get(n);if(o==null){let i=r.encode(t);return e.set(n,i),i}else return o},Ge=112,aa=18,cn=(t,e,r)=>{let n=Ne(t),o=n+Ne(e),i=new Uint8Array(o+r.byteLength);return ke(t,i,0),ke(e,i,n),i.set(r,o),i},un=Symbol.for("@ipld/js-cid/CID"),wt={writable:!1,configurable:!1,enumerable:!0},bt={writable:!1,enumerable:!1,configurable:!1},ca="0.0.0-dev",ua=(t,e)=>{if(t.test(ca))console.warn(e);else throw new Error(e)},fa=`CID.isCID(v) is deprecated and will be removed in the next major release.
Following code pattern:

if (CID.isCID(value)) {
  doSomethingWithCID(value)
}

Is replaced with:

const cid = CID.asCID(value)
if (cid) {
  // Make sure to use cid instead of value
  doSomethingWithCID(cid)
}
`;var fn=(t=21)=>{let e="",r=crypto.getRandomValues(new Uint8Array(t));for(;t--;){let n=r[t]&63;n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n<63?e+="_":e+="-"}return e};var Xt={};M(Xt,{identity:()=>la});var la=yt({prefix:"\0",name:"identity",encode:t=>Xr(t),decode:t=>Yr(t)});var Zt={};M(Zt,{base2:()=>da});var da=B({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Qt={};M(Qt,{base8:()=>ha});var ha=B({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var er={};M(er,{base10:()=>pa});var pa=he({prefix:"9",name:"base10",alphabet:"0123456789"});var tr={};M(tr,{base16:()=>ma,base16upper:()=>ga});var ma=B({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ga=B({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var rr={};M(rr,{base36:()=>ya,base36upper:()=>wa});var ya=he({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),wa=he({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var nr={};M(nr,{base64:()=>ba,base64pad:()=>xa,base64url:()=>va,base64urlpad:()=>Ea});var ba=B({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),xa=B({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),va=B({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ea=B({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var or={};M(or,{sha256:()=>Fe,sha512:()=>Ca});var We=({name:t,code:e,encode:r})=>new ln(t,e,r),ln=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}async digest(e){if(e instanceof Uint8Array){let r=await this.encode(e);return gt(this.code,r)}else throw Error("Unknown type, must be binary type")}};var hn=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Fe=We({name:"sha2-256",code:18,encode:hn("SHA-256")}),Ca=We({name:"sha2-512",code:19,encode:hn("SHA-512")});var ir={};M(ir,{identity:()=>Aa});var Aa=We({name:"identity",code:0,encode:t=>ue(t)});var pn=85;var Gu=new TextEncoder,Wu=new TextDecoder;var sr={...Xt,...Zt,...Qt,...er,...tr,...Yt,...rr,...Jt,...nr},Xu={...or,...ir};function mn(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}var gn=mn("utf8","u",t=>{let e=new TextDecoder("utf8");return"u"+e.decode(t)},t=>new TextEncoder().encode(t.substring(1))),ar=mn("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);let e=new Uint8Array(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Ba={utf8:gn,"utf-8":gn,hex:sr.base16,latin1:ar,ascii:ar,binary:ar,...sr},xt=Ba;function pe(t,e="utf8"){let r=xt[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return r.encoder.encode(t).substring(1)}function me(t,e="utf8"){let r=xt[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return r.decoder.decode(`${r.prefix}${t}`)}var fe="/",yn=new TextEncoder().encode(fe),vt=yn[0],_=class{constructor(e,r){if(typeof e=="string")this._buf=me(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(r==null&&(r=!0),r&&this.clean(),this._buf.byteLength===0||this._buf[0]!==vt)throw new Error("Invalid key")}toString(e="utf8"){return pe(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new _(e.join(fe))}static random(){return new _(fn().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new _(e):e.uint8Array?new _(e.uint8Array()):null}clean(){if((!this._buf||this._buf.byteLength===0)&&(this._buf=yn),this._buf[0]!==vt){let e=new Uint8Array(this._buf.byteLength+1);e.fill(vt,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===vt;)this._buf=this._buf.subarray(0,-1)}less(e){let r=this.list(),n=e.list();for(let o=0;o<r.length;o++){if(n.length<o+1)return!1;let i=r[o],s=n[o];if(i<s)return!0;if(i>s)return!1}return r.length<n.length}reverse(){return _.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(fe).slice(1)}type(){return Ta(this.baseNamespace())}name(){return ja(this.baseNamespace())}instance(e){return new _(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(fe)||(e+=fe),e+=this.type(),new _(e)}parent(){let e=this.list();return e.length===1?new _(fe):new _(e.slice(0,-1).join(fe))}child(e){return this.toString()===fe?e:e.toString()===fe?this:new _(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return _.withNamespaces([...this.namespaces(),...ka(e.map(r=>r.namespaces()))])}};function Ta(t){let e=t.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function ja(t){let e=t.split(":");return e[e.length-1]}function ka(t){return[].concat(...t)}var Cn=ce(At()),An=ce(cr());var Ha=(0,Cn.default)("ipfs:repo:migrator:migration-8");function _n(t){return t.child?_n(t.child):t}function Va(t){try{let e=D.decode(`b${t.toString().toLowerCase().slice(1)}`),r=x.decode(e).multihash.bytes,n=D.encode(r).slice(1).toUpperCase();return new _(`/${n}`,!1)}catch(e){return t}}function Ga(t){try{let e=D.decode(`b${t.toString().toLowerCase().slice(1)}`),r=Ie(e),n=D.encode(x.createV1(pn,r).bytes).slice(1);return new _(`/${n.toUpperCase()}`,!1)}catch{return t}}async function Sn(t,e,r){let n=t.blocks;await n.open();let o=_n(n),i=await(0,An.default)(o.queryKeys({filters:[s=>r(s).toString()!==s.toString()]}));try{let s=0;for await(let a of o.query({})){let c=r(a.key);c.toString()!==a.key.toString()&&(s+=1,Ha(`Migrating Block from ${a.key} to ${c}`,await o.has(a.key)),await o.delete(a.key),await o.put(c,a.value),e(s/i*100,`Migrated Block from ${a.key} to ${c}`))}}finally{await n.close()}}var Bn={version:8,description:"Transforms key names into base32 encoding and converts Block store to use bare multihashes encoded as base32",migrate:(t,e=()=>{})=>Sn(t,e,Va),revert:(t,e=()=>{})=>Sn(t,e,Ga)};var Wa=new TextDecoder;function ur(t,e){let r=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(e>=t.length)throw new Error("protobuf: unexpected end of data");let o=t[e++];if(r+=n<28?(o&127)<<n:(o&127)*2**n,o<128)break}return[r,e]}function _t(t,e){let r;[r,e]=ur(t,e);let n=e+r;if(r<0||n<0)throw new Error("protobuf: invalid length");if(n>t.length)throw new Error("protobuf: unexpected end of data");return[t.subarray(e,n),n]}function Tn(t,e){let r;return[r,e]=ur(t,e),[r&7,r>>3,e]}function Ka(t){let e={},r=t.length,n=0;for(;n<r;){let o,i;if([o,i,n]=Tn(t,n),i===1){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(o!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${o}) for Hash`);if(e.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,n]=_t(t,n)}else if(i===2){if(e.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(o!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${o}) for Name`);if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let s;[s,n]=_t(t,n),e.Name=Wa.decode(s)}else if(i===3){if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(o!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${o}) for Tsize`);[e.Tsize,n]=ur(t,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${i}`)}if(n>r)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function jn(t){let e=t.length,r=0,n,o=!1,i;for(;r<e;){let a,c;if([a,c,r]=Tn(t,r),a!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${a}`);if(c===1){if(i)throw new Error("protobuf: (PBNode) duplicate Data section");[i,r]=_t(t,r),n&&(o=!0)}else if(c===2){if(o)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let f;[f,r]=_t(t,r),n.push(Ka(f))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${c}`)}if(r>e)throw new Error("protobuf: (PBNode) unexpected end of data");let s={};return i&&(s.Data=i),s.Links=n||[],s}var kn=new TextEncoder,Nn=2**32,Ja=2**31;function Ya(t,e){let r=e.length;if(typeof t.Tsize=="number"){if(t.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(t.Tsize))throw new Error("Tsize too large for encoding");r=Ke(e,r,t.Tsize)-1,e[r]=24}if(typeof t.Name=="string"){let n=kn.encode(t.Name);r-=n.length,e.set(n,r),r=Ke(e,r,n.length)-1,e[r]=18}return t.Hash&&(r-=t.Hash.length,e.set(t.Hash,r),r=Ke(e,r,t.Hash.length)-1,e[r]=10),e.length-r}function In(t){let e=Za(t),r=new Uint8Array(e),n=e;if(t.Data&&(n-=t.Data.length,r.set(t.Data,n),n=Ke(r,n,t.Data.length)-1,r[n]=10),t.Links)for(let o=t.Links.length-1;o>=0;o--){let i=Ya(t.Links[o],r.subarray(0,n));n-=i,n=Ke(r,n,i)-1,r[n]=18}return r}function Xa(t){let e=0;if(t.Hash){let r=t.Hash.length;e+=1+r+Oe(r)}if(typeof t.Name=="string"){let r=kn.encode(t.Name).length;e+=1+r+Oe(r)}return typeof t.Tsize=="number"&&(e+=1+Oe(t.Tsize)),e}function Za(t){let e=0;if(t.Data){let r=t.Data.length;e+=1+r+Oe(r)}if(t.Links)for(let r of t.Links){let n=Xa(r);e+=1+n+Oe(n)}return e}function Ke(t,e,r){e-=Oe(r);let n=e;for(;r>=Ja;)t[e++]=r&127|128,r/=128;for(;r>=128;)t[e++]=r&127|128,r>>>=7;return t[e]=r,n}function Oe(t){return t%2==0&&t++,Math.floor((Qa(t)+6)/7)}function Qa(t){let e=0;return t>=Nn&&(t=Math.floor(t/Nn),e=32),t>=1<<16&&(t>>>=16,e+=16),t>=1<<8&&(t>>>=8,e+=8),e+ec[t]}var ec=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8];var tc=["Data","Links"],rc=["Hash","Name","Tsize"],Fn=new TextEncoder;function nc(t,e){if(t===e)return 0;let r=t.Name?Fn.encode(t.Name):[],n=e.Name?Fn.encode(e.Name):[],o=r.length,i=n.length;for(let s=0,a=Math.min(o,i);s<a;++s)if(r[s]!==n[s]){o=r[s],i=n[s];break}return o<i?-1:i<o?1:0}function Dn(t,e){return!Object.keys(t).some(r=>!e.includes(r))}function Un(t){if(!t||typeof t!="object"||Array.isArray(t))throw new TypeError("Invalid DAG-PB form");if(!Dn(t,tc))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(t.Data!==void 0&&!(t.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be a Uint8Array)");if(!Array.isArray(t.Links))throw new TypeError("Invalid DAG-PB form (Links must be an array)");for(let e=0;e<t.Links.length;e++){let r=t.Links[e];if(!r||typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form (bad link object)");if(!Dn(r,rc))throw new TypeError("Invalid DAG-PB form (extraneous properties on link object)");if(!r.Hash)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(r.Hash.asCID!==r.Hash)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(r.Name!==void 0&&typeof r.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(r.Tsize!==void 0&&(typeof r.Tsize!="number"||r.Tsize%1!=0))throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(e>0&&nc(r,t.Links[e-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}var St=112;function Je(t){Un(t);let e={};return t.Links&&(e.Links=t.Links.map(r=>{let n={};return r.Hash&&(n.Hash=r.Hash.bytes),r.Name!==void 0&&(n.Name=r.Name),r.Tsize!==void 0&&(n.Tsize=r.Tsize),n})),t.Data&&(e.Data=t.Data),In(e)}function Ye(t){let e=jn(t),r={};return e.Data&&(r.Data=e.Data),e.Links&&(r.Links=e.Links.map(n=>{let o={};try{o.Hash=x.decode(n.Hash)}catch(i){}if(!o.Hash)throw new Error("Invalid Hash field found in link, expected CID");return n.Name!==void 0&&(o.Name=n.Name),n.Tsize!==void 0&&(o.Tsize=n.Tsize),o})),r}var oc=["string","number","bigint","symbol"],ic=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function Ln(t){if(t===null)return"null";if(t===void 0)return"undefined";if(t===!0||t===!1)return"boolean";let e=typeof t;if(oc.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(t))return"Array";if(sc(t))return"Buffer";let r=ac(t);return r||"Object"}function sc(t){return t&&t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer.call(null,t)}function ac(t){let e=Object.prototype.toString.call(t).slice(8,-1);if(ic.includes(e))return e}var l=class{constructor(e,r,n){this.major=e,this.majorEncoded=e<<5,this.name=r,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}};l.uint=new l(0,"uint",!0);l.negint=new l(1,"negint",!0);l.bytes=new l(2,"bytes",!0);l.string=new l(3,"string",!0);l.array=new l(4,"array",!1);l.map=new l(5,"map",!1);l.tag=new l(6,"tag",!1);l.float=new l(7,"float",!0);l.false=new l(7,"false",!0);l.true=new l(7,"true",!0);l.null=new l(7,"null",!0);l.undefined=new l(7,"undefined",!0);l.break=new l(7,"break",!0);var p=class{constructor(e,r,n){this.type=e,this.value=r,this.encodedLength=n,this.encodedBytes=void 0}toString(){return`Token[${this.type}].${this.value}`}};var Me=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",cc=new TextDecoder,uc=new TextEncoder;function Bt(t){return Me&&globalThis.Buffer.isBuffer(t)}function fr(t){return t instanceof Uint8Array?Bt(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t:Uint8Array.from(t)}var On=Me?(t,e,r)=>r-e>64?globalThis.Buffer.from(t.subarray(e,r)).toString("utf8"):qn(t,e,r):(t,e,r)=>r-e>64?cc.decode(t.subarray(e,r)):qn(t,e,r),Mn=Me?t=>t.length>64?globalThis.Buffer.from(t):Pn(t):t=>t.length>64?uc.encode(t):Pn(t),oe=t=>Uint8Array.from(t),Tt=Me?(t,e,r)=>Bt(t)?new Uint8Array(t.subarray(e,r)):t.slice(e,r):(t,e,r)=>t.slice(e,r),$n=Me?(t,e)=>(t=t.map(r=>r instanceof Uint8Array?r:globalThis.Buffer.from(r)),fr(globalThis.Buffer.concat(t,e))):(t,e)=>{let r=new Uint8Array(e),n=0;for(let o of t)n+o.length>r.length&&(o=o.subarray(0,r.length-n)),r.set(o,n),n+=o.length;return r},zn=Me?t=>globalThis.Buffer.allocUnsafe(t):t=>new Uint8Array(t);function Rn(t,e){if(Bt(t)&&Bt(e))return t.compare(e);for(let r=0;r<t.length;r++)if(t[r]!==e[r])return t[r]<e[r]?-1:1;return 0}function Pn(t,e=1/0){let r,n=t.length,o=null,i=[];for(let s=0;s<n;++s){if(r=t.charCodeAt(s),r>55295&&r<57344){if(!o){if(r>56319){(e-=3)>-1&&i.push(239,191,189);continue}else if(s+1===n){(e-=3)>-1&&i.push(239,191,189);continue}o=r;continue}if(r<56320){(e-=3)>-1&&i.push(239,191,189),o=r;continue}r=(o-55296<<10|r-56320)+65536}else o&&(e-=3)>-1&&i.push(239,191,189);if(o=null,r<128){if((e-=1)<0)break;i.push(r)}else if(r<2048){if((e-=2)<0)break;i.push(r>>6|192,r&63|128)}else if(r<65536){if((e-=3)<0)break;i.push(r>>12|224,r>>6&63|128,r&63|128)}else if(r<1114112){if((e-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,r&63|128)}else throw new Error("Invalid code point")}return i}function qn(t,e,r){let n=[];for(;e<r;){let o=t[e],i=null,s=o>239?4:o>223?3:o>191?2:1;if(e+s<=r){let a,c,f,u;switch(s){case 1:o<128&&(i=o);break;case 2:a=t[e+1],(a&192)==128&&(u=(o&31)<<6|a&63,u>127&&(i=u));break;case 3:a=t[e+1],c=t[e+2],(a&192)==128&&(c&192)==128&&(u=(o&15)<<12|(a&63)<<6|c&63,u>2047&&(u<55296||u>57343)&&(i=u));break;case 4:a=t[e+1],c=t[e+2],f=t[e+3],(a&192)==128&&(c&192)==128&&(f&192)==128&&(u=(o&15)<<18|(a&63)<<12|(c&63)<<6|f&63,u>65535&&u<1114112&&(i=u))}}i===null?(i=65533,s=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|i&1023),n.push(i),e+=s}return fc(n)}var Hn=4096;function fc(t){let e=t.length;if(e<=Hn)return String.fromCharCode.apply(String,t);let r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=Hn));return r}var lc=256,jt=class{constructor(e=lc){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.chunks=[],this.cursor=0,this.maxCursor=-1,this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let r=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){let o=r.length-(this.maxCursor-this.cursor)-1;r.set(e,o)}else{if(r){let o=r.length-(this.maxCursor-this.cursor)-1;o<r.length&&(this.chunks[this.chunks.length-1]=r.subarray(0,o),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(r=zn(this.chunkSize),this.chunks.push(r),this.maxCursor+=r.length,this._initReuseChunk===null&&(this._initReuseChunk=r),r.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let r;if(this.chunks.length===1){let n=this.chunks[0];e&&this.cursor>n.length/2?(r=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):r=Tt(n,0,this.cursor)}else r=$n(this.chunks,this.cursor);return e&&this.reset(),r}};var y="CBOR decode error:",lr="CBOR encode error:",Xe=[];Xe[23]=1;Xe[24]=2;Xe[25]=3;Xe[26]=5;Xe[27]=9;function le(t,e,r){if(t.length-e<r)throw new Error(`${y} not enough data for type`)}var k=[24,256,65536,4294967296,BigInt("18446744073709551616")];function z(t,e,r){le(t,e,1);let n=t[e];if(r.strict===!0&&n<k[0])throw new Error(`${y} integer encoded in more bytes than necessary (strict decode)`);return n}function R(t,e,r){le(t,e,2);let n=t[e]<<8|t[e+1];if(r.strict===!0&&n<k[1])throw new Error(`${y} integer encoded in more bytes than necessary (strict decode)`);return n}function P(t,e,r){le(t,e,4);let n=t[e]*16777216+(t[e+1]<<16)+(t[e+2]<<8)+t[e+3];if(r.strict===!0&&n<k[2])throw new Error(`${y} integer encoded in more bytes than necessary (strict decode)`);return n}function q(t,e,r){le(t,e,8);let n=t[e]*16777216+(t[e+1]<<16)+(t[e+2]<<8)+t[e+3],o=t[e+4]*16777216+(t[e+5]<<16)+(t[e+6]<<8)+t[e+7],i=(BigInt(n)<<BigInt(32))+BigInt(o);if(r.strict===!0&&i<k[3])throw new Error(`${y} integer encoded in more bytes than necessary (strict decode)`);if(i<=Number.MAX_SAFE_INTEGER)return Number(i);if(r.allowBigInt===!0)return i;throw new Error(`${y} integers outside of the safe integer range are not supported`)}function Vn(t,e,r,n){return new p(l.uint,z(t,e+1,n),2)}function Gn(t,e,r,n){return new p(l.uint,R(t,e+1,n),3)}function Wn(t,e,r,n){return new p(l.uint,P(t,e+1,n),5)}function Kn(t,e,r,n){return new p(l.uint,q(t,e+1,n),9)}function K(t,e){return U(t,0,e.value)}function U(t,e,r){if(r<k[0]){let n=Number(r);t.push([e|n])}else if(r<k[1]){let n=Number(r);t.push([e|24,n])}else if(r<k[2]){let n=Number(r);t.push([e|25,n>>>8,n&255])}else if(r<k[3]){let n=Number(r);t.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{let n=BigInt(r);if(n<k[4]){let o=[e|27,0,0,0,0,0,0,0],i=Number(n&BigInt(4294967295)),s=Number(n>>BigInt(32)&BigInt(4294967295));o[8]=i&255,i=i>>8,o[7]=i&255,i=i>>8,o[6]=i&255,i=i>>8,o[5]=i&255,o[4]=s&255,s=s>>8,o[3]=s&255,s=s>>8,o[2]=s&255,s=s>>8,o[1]=s&255,t.push(o)}else throw new Error(`${y} encountered BigInt larger than allowable range`)}}K.encodedSize=function(e){return U.encodedSize(e.value)};U.encodedSize=function(e){return e<k[0]?1:e<k[1]?2:e<k[2]?3:e<k[3]?5:9};K.compareTokens=function(e,r){return e.value<r.value?-1:e.value>r.value?1:0};function Jn(t,e,r,n){return new p(l.negint,-1-z(t,e+1,n),2)}function Yn(t,e,r,n){return new p(l.negint,-1-R(t,e+1,n),3)}function Xn(t,e,r,n){return new p(l.negint,-1-P(t,e+1,n),5)}var dr=BigInt(-1),Zn=BigInt(1);function Qn(t,e,r,n){let o=q(t,e+1,n);if(typeof o!="bigint"){let i=-1-o;if(i>=Number.MIN_SAFE_INTEGER)return new p(l.negint,i,9)}if(n.allowBigInt!==!0)throw new Error(`${y} integers outside of the safe integer range are not supported`);return new p(l.negint,dr-BigInt(o),9)}function kt(t,e){let r=e.value,n=typeof r=="bigint"?r*dr-Zn:r*-1-1;U(t,e.type.majorEncoded,n)}kt.encodedSize=function(e){let r=e.value,n=typeof r=="bigint"?r*dr-Zn:r*-1-1;return n<k[0]?1:n<k[1]?2:n<k[2]?3:n<k[3]?5:9};kt.compareTokens=function(e,r){return e.value<r.value?1:e.value>r.value?-1:0};function Ze(t,e,r,n){le(t,e,r+n);let o=Tt(t,e+r,e+r+n);return new p(l.bytes,o,r+n)}function eo(t,e,r,n){return Ze(t,e,1,r)}function to(t,e,r,n){return Ze(t,e,2,z(t,e+1,n))}function ro(t,e,r,n){return Ze(t,e,3,R(t,e+1,n))}function no(t,e,r,n){return Ze(t,e,5,P(t,e+1,n))}function oo(t,e,r,n){let o=q(t,e+1,n);if(typeof o=="bigint")throw new Error(`${y} 64-bit integer bytes lengths not supported`);return Ze(t,e,9,o)}function Nt(t){return t.encodedBytes===void 0&&(t.encodedBytes=t.type===l.string?Mn(t.value):t.value),t.encodedBytes}function $e(t,e){let r=Nt(e);U(t,e.type.majorEncoded,r.length),t.push(r)}$e.encodedSize=function(e){let r=Nt(e);return U.encodedSize(r.length)+r.length};$e.compareTokens=function(e,r){return dc(Nt(e),Nt(r))};function dc(t,e){return t.length<e.length?-1:t.length>e.length?1:Rn(t,e)}function Qe(t,e,r,n){let o=r+n;return le(t,e,o),new p(l.string,On(t,e+r,e+o),o)}function io(t,e,r,n){return Qe(t,e,1,r)}function so(t,e,r,n){return Qe(t,e,2,z(t,e+1,n))}function ao(t,e,r,n){return Qe(t,e,3,R(t,e+1,n))}function co(t,e,r,n){return Qe(t,e,5,P(t,e+1,n))}function uo(t,e,r,n){let o=q(t,e+1,n);if(typeof o=="bigint")throw new Error(`${y} 64-bit integer string lengths not supported`);return Qe(t,e,9,o)}var fo=$e;function ze(t,e,r,n){return new p(l.array,n,r)}function lo(t,e,r,n){return ze(t,e,1,r)}function ho(t,e,r,n){return ze(t,e,2,z(t,e+1,n))}function po(t,e,r,n){return ze(t,e,3,R(t,e+1,n))}function mo(t,e,r,n){return ze(t,e,5,P(t,e+1,n))}function go(t,e,r,n){let o=q(t,e+1,n);if(typeof o=="bigint")throw new Error(`${y} 64-bit integer array lengths not supported`);return ze(t,e,9,o)}function yo(t,e,r,n){if(n.allowIndefinite===!1)throw new Error(`${y} indefinite length items not allowed`);return ze(t,e,1,1/0)}function hr(t,e){U(t,l.array.majorEncoded,e.value)}hr.compareTokens=K.compareTokens;function Re(t,e,r,n){return new p(l.map,n,r)}function wo(t,e,r,n){return Re(t,e,1,r)}function bo(t,e,r,n){return Re(t,e,2,z(t,e+1,n))}function xo(t,e,r,n){return Re(t,e,3,R(t,e+1,n))}function vo(t,e,r,n){return Re(t,e,5,P(t,e+1,n))}function Eo(t,e,r,n){let o=q(t,e+1,n);if(typeof o=="bigint")throw new Error(`${y} 64-bit integer map lengths not supported`);return Re(t,e,9,o)}function Co(t,e,r,n){if(n.allowIndefinite===!1)throw new Error(`${y} indefinite length items not allowed`);return Re(t,e,1,1/0)}function pr(t,e){U(t,l.map.majorEncoded,e.value)}pr.compareTokens=K.compareTokens;function Ao(t,e,r,n){return new p(l.tag,r,1)}function _o(t,e,r,n){return new p(l.tag,z(t,e+1,n),2)}function So(t,e,r,n){return new p(l.tag,R(t,e+1,n),3)}function Bo(t,e,r,n){return new p(l.tag,P(t,e+1,n),5)}function To(t,e,r,n){return new p(l.tag,q(t,e+1,n),9)}function mr(t,e){U(t,l.tag.majorEncoded,e.value)}mr.compareTokens=K.compareTokens;var hc=20,pc=21,mc=22,gc=23;function jo(t,e,r,n){if(n.allowUndefined===!1)throw new Error(`${y} undefined values are not supported`);return new p(l.undefined,void 0,1)}function ko(t,e,r,n){if(n.allowIndefinite===!1)throw new Error(`${y} indefinite length items not allowed`);return new p(l.break,void 0,1)}function gr(t,e,r){if(r){if(r.allowNaN===!1&&Number.isNaN(t))throw new Error(`${y} NaN values are not supported`);if(r.allowInfinity===!1&&(t===1/0||t===-1/0))throw new Error(`${y} Infinity values are not supported`)}return new p(l.float,t,e)}function No(t,e,r,n){return gr(yr(t,e+1),3,n)}function Io(t,e,r,n){return gr(wr(t,e+1),5,n)}function Fo(t,e,r,n){return gr(Oo(t,e+1),9,n)}function It(t,e,r){let n=e.value;if(n===!1)t.push([l.float.majorEncoded|hc]);else if(n===!0)t.push([l.float.majorEncoded|pc]);else if(n===null)t.push([l.float.majorEncoded|mc]);else if(n===void 0)t.push([l.float.majorEncoded|gc]);else{let o,i=!1;(!r||r.float64!==!0)&&(Uo(n),o=yr(Z,1),n===o||Number.isNaN(n)?(Z[0]=249,t.push(Z.slice(0,3)),i=!0):(Lo(n),o=wr(Z,1),n===o&&(Z[0]=250,t.push(Z.slice(0,5)),i=!0))),i||(yc(n),o=Oo(Z,1),Z[0]=251,t.push(Z.slice(0,9)))}}It.encodedSize=function(e,r){let n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;let o;if(!r||r.float64!==!0){if(Uo(n),o=yr(Z,1),n===o||Number.isNaN(n))return 3;if(Lo(n),o=wr(Z,1),n===o)return 5}return 9};var Do=new ArrayBuffer(9),J=new DataView(Do,1),Z=new Uint8Array(Do,0);function Uo(t){if(t===1/0)J.setUint16(0,31744,!1);else if(t===-1/0)J.setUint16(0,64512,!1);else if(Number.isNaN(t))J.setUint16(0,32256,!1);else{J.setFloat32(0,t);let e=J.getUint32(0),r=(e&2139095040)>>23,n=e&8388607;if(r===255)J.setUint16(0,31744,!1);else if(r===0)J.setUint16(0,(t&2147483648)>>16|n>>13,!1);else{let o=r-127;o<-24?J.setUint16(0,0):o<-14?J.setUint16(0,(e&2147483648)>>16|1<<24+o,!1):J.setUint16(0,(e&2147483648)>>16|o+15<<10|n>>13,!1)}}}function yr(t,e){if(t.length-e<2)throw new Error(`${y} not enough data for float16`);let r=(t[e]<<8)+t[e+1];if(r===31744)return 1/0;if(r===64512)return-1/0;if(r===32256)return NaN;let n=r>>10&31,o=r&1023,i;return n===0?i=o*2**-24:n!==31?i=(o+1024)*2**(n-25):i=o===0?1/0:NaN,r&32768?-i:i}function Lo(t){J.setFloat32(0,t,!1)}function wr(t,e){if(t.length-e<4)throw new Error(`${y} not enough data for float32`);let r=(t.byteOffset||0)+e;return new DataView(t.buffer,r,4).getFloat32(0,!1)}function yc(t){J.setFloat64(0,t,!1)}function Oo(t,e){if(t.length-e<8)throw new Error(`${y} not enough data for float64`);let r=(t.byteOffset||0)+e;return new DataView(t.buffer,r,8).getFloat64(0,!1)}It.compareTokens=K.compareTokens;function C(t,e,r){throw new Error(`${y} encountered invalid minor (${r}) for major ${t[e]>>>5}`)}function Ft(t){return()=>{throw new Error(`${y} ${t}`)}}var h=[];for(let t=0;t<=23;t++)h[t]=C;h[24]=Vn;h[25]=Gn;h[26]=Wn;h[27]=Kn;h[28]=C;h[29]=C;h[30]=C;h[31]=C;for(let t=32;t<=55;t++)h[t]=C;h[56]=Jn;h[57]=Yn;h[58]=Xn;h[59]=Qn;h[60]=C;h[61]=C;h[62]=C;h[63]=C;for(let t=64;t<=87;t++)h[t]=eo;h[88]=to;h[89]=ro;h[90]=no;h[91]=oo;h[92]=C;h[93]=C;h[94]=C;h[95]=Ft("indefinite length bytes/strings are not supported");for(let t=96;t<=119;t++)h[t]=io;h[120]=so;h[121]=ao;h[122]=co;h[123]=uo;h[124]=C;h[125]=C;h[126]=C;h[127]=Ft("indefinite length bytes/strings are not supported");for(let t=128;t<=151;t++)h[t]=lo;h[152]=ho;h[153]=po;h[154]=mo;h[155]=go;h[156]=C;h[157]=C;h[158]=C;h[159]=yo;for(let t=160;t<=183;t++)h[t]=wo;h[184]=bo;h[185]=xo;h[186]=vo;h[187]=Eo;h[188]=C;h[189]=C;h[190]=C;h[191]=Co;for(let t=192;t<=215;t++)h[t]=Ao;h[216]=_o;h[217]=So;h[218]=Bo;h[219]=To;h[220]=C;h[221]=C;h[222]=C;h[223]=C;for(let t=224;t<=243;t++)h[t]=Ft("simple values are not supported");h[244]=C;h[245]=C;h[246]=C;h[247]=jo;h[248]=Ft("simple values are not supported");h[249]=No;h[250]=Io;h[251]=Fo;h[252]=C;h[253]=C;h[254]=C;h[255]=ko;var Q=[];for(let t=0;t<24;t++)Q[t]=new p(l.uint,t,1);for(let t=-1;t>=-24;t--)Q[31-t]=new p(l.negint,t,1);Q[64]=new p(l.bytes,new Uint8Array(0),1);Q[96]=new p(l.string,"",1);Q[128]=new p(l.array,0,1);Q[160]=new p(l.map,0,1);Q[244]=new p(l.false,!1,1);Q[245]=new p(l.true,!0,1);Q[246]=new p(l.null,null,1);function Mo(t){switch(t.type){case l.false:return oe([244]);case l.true:return oe([245]);case l.null:return oe([246]);case l.bytes:return t.value.length?void 0:oe([64]);case l.string:return t.value===""?oe([96]):void 0;case l.array:return t.value===0?oe([128]):void 0;case l.map:return t.value===0?oe([160]):void 0;case l.uint:return t.value<24?oe([Number(t.value)]):void 0;case l.negint:if(t.value>=-24)return oe([31-Number(t.value)])}}var wc={float64:!1,mapSorter:xc,quickEncodeToken:Mo},ie=[];ie[l.uint.major]=K;ie[l.negint.major]=kt;ie[l.bytes.major]=$e;ie[l.string.major]=fo;ie[l.array.major]=hr;ie[l.map.major]=pr;ie[l.tag.major]=mr;ie[l.float.major]=It;var $o=new jt,et=class{constructor(e,r){this.obj=e,this.parent=r}includes(e){let r=this;do if(r.obj===e)return!0;while(r=r.parent);return!1}static createCheck(e,r){if(e&&e.includes(r))throw new Error(`${lr} object contains circular references`);return new et(r,e)}},ge={null:new p(l.null,null),undefined:new p(l.undefined,void 0),true:new p(l.true,!0),false:new p(l.false,!1),emptyArray:new p(l.array,0),emptyMap:new p(l.map,0)},ye={number(t,e,r,n){return!Number.isInteger(t)||!Number.isSafeInteger(t)?new p(l.float,t):t>=0?new p(l.uint,t):new p(l.negint,t)},bigint(t,e,r,n){return t>=BigInt(0)?new p(l.uint,t):new p(l.negint,t)},Uint8Array(t,e,r,n){return new p(l.bytes,t)},string(t,e,r,n){return new p(l.string,t)},boolean(t,e,r,n){return t?ge.true:ge.false},null(t,e,r,n){return ge.null},undefined(t,e,r,n){return ge.undefined},ArrayBuffer(t,e,r,n){return new p(l.bytes,new Uint8Array(t))},DataView(t,e,r,n){return new p(l.bytes,new Uint8Array(t.buffer,t.byteOffset,t.byteLength))},Array(t,e,r,n){if(!t.length)return r.addBreakTokens===!0?[ge.emptyArray,new p(l.break)]:ge.emptyArray;n=et.createCheck(n,t);let o=[],i=0;for(let s of t)o[i++]=Dt(s,r,n);return r.addBreakTokens?[new p(l.array,t.length),o,new p(l.break)]:[new p(l.array,t.length),o]},Object(t,e,r,n){let o=e!=="Object",i=o?t.keys():Object.keys(t),s=o?t.size:i.length;if(!s)return r.addBreakTokens===!0?[ge.emptyMap,new p(l.break)]:ge.emptyMap;n=et.createCheck(n,t);let a=[],c=0;for(let f of i)a[c++]=[Dt(f,r,n),Dt(o?t.get(f):t[f],r,n)];return bc(a,r),r.addBreakTokens?[new p(l.map,s),a,new p(l.break)]:[new p(l.map,s),a]}};ye.Map=ye.Object;ye.Buffer=ye.Uint8Array;for(let t of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))ye[`${t}Array`]=ye.DataView;function Dt(t,e={},r){let n=Ln(t),o=e&&e.typeEncoders&&e.typeEncoders[n]||ye[n];if(typeof o=="function"){let s=o(t,n,e,r);if(s!=null)return s}let i=ye[n];if(!i)throw new Error(`${lr} unsupported type: ${n}`);return i(t,n,e,r)}function bc(t,e){e.mapSorter&&t.sort(e.mapSorter)}function xc(t,e){let r=Array.isArray(t[0])?t[0][0]:t[0],n=Array.isArray(e[0])?e[0][0]:e[0];if(r.type!==n.type)return r.type.compare(n.type);let o=r.type.major,i=ie[o].compareTokens(r,n);return i===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),i}function zo(t,e,r,n){if(Array.isArray(e))for(let o of e)zo(t,o,r,n);else r[e.type.major](t,e,n)}function vc(t,e,r){let n=Dt(t,r);if(!Array.isArray(n)&&r.quickEncodeToken){let o=r.quickEncodeToken(n);if(o)return o;let i=e[n.type.major];if(i.encodedSize){let s=i.encodedSize(n,r),a=new jt(s);if(i(a,n,r),a.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return fr(a.chunks[0])}}return zo($o,n,e,r),$o.toBytes(!0)}function Ut(t,e){return e=Object.assign({},wc,e),vc(t,ie,e)}var Ec={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0},Ro=class{constructor(e,r={}){this.pos=0,this.data=e,this.options=r}done(){return this.pos>=this.data.length}next(){let e=this.data[this.pos],r=Q[e];if(r===void 0){let n=h[e];if(!n)throw new Error(`${y} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);let o=e&31;r=n(this.data,this.pos,o,this.options)}return this.pos+=r.encodedLength,r}},tt=Symbol.for("DONE"),Lt=Symbol.for("BREAK");function Cc(t,e,r){let n=[];for(let o=0;o<t.value;o++){let i=rt(e,r);if(i===Lt){if(t.value===1/0)break;throw new Error(`${y} got unexpected break to lengthed array`)}if(i===tt)throw new Error(`${y} found array but not enough entries (got ${o}, expected ${t.value})`);n[o]=i}return n}function Ac(t,e,r){let n=r.useMaps===!0,o=n?void 0:{},i=n?new Map:void 0;for(let s=0;s<t.value;s++){let a=rt(e,r);if(a===Lt){if(t.value===1/0)break;throw new Error(`${y} got unexpected break to lengthed map`)}if(a===tt)throw new Error(`${y} found map but not enough entries (got ${s} [no key], expected ${t.value})`);if(n!==!0&&typeof a!="string")throw new Error(`${y} non-string keys not supported (got ${typeof a})`);let c=rt(e,r);if(c===tt)throw new Error(`${y} found map but not enough entries (got ${s} [no value], expected ${t.value})`);n?i.set(a,c):o[a]=c}return n?i:o}function rt(t,e){if(t.done())return tt;let r=t.next();if(r.type===l.break)return Lt;if(r.type.terminal)return r.value;if(r.type===l.array)return Cc(r,t,e);if(r.type===l.map)return Ac(r,t,e);if(r.type===l.tag){if(e.tags&&typeof e.tags[r.value]=="function"){let n=rt(t,e);return e.tags[r.value](n)}throw new Error(`${y} tag not supported (${r.value})`)}throw new Error("unsupported")}function br(t,e){if(!(t instanceof Uint8Array))throw new Error(`${y} data to decode must be a Uint8Array`);e=Object.assign({},Ec,e);let r=e.tokenizer||new Ro(t,e),n=rt(r,e);if(n===tt)throw new Error(`${y} did not find any content to decode`);if(n===Lt)throw new Error(`${y} got unexpected break`);if(!r.done())throw new Error(`${y} too many terminals, data makes no sense`);return n}var _e=ce(Mi()),$i=_e.default.Reader,Dc=_e.default.Writer,pd=_e.default.util,Rt=_e.default.roots.default||(_e.default.roots.default={}),zi=Rt.ipfs=(()=>{let t={};return t.pin=function(){let e={};return e.Set=function(){function r(n){if(n)for(var o=Object.keys(n),i=0;i<o.length;++i)n[o[i]]!=null&&(this[o[i]]=n[o[i]])}return r.prototype.version=0,r.prototype.fanout=0,r.prototype.seed=0,r.encode=function(o,i){return i||(i=Dc.create()),o.version!=null&&Object.hasOwnProperty.call(o,"version")&&i.uint32(8).uint32(o.version),o.fanout!=null&&Object.hasOwnProperty.call(o,"fanout")&&i.uint32(16).uint32(o.fanout),o.seed!=null&&Object.hasOwnProperty.call(o,"seed")&&i.uint32(29).fixed32(o.seed),i},r.decode=function(o,i){o instanceof $i||(o=$i.create(o));for(var s=i===void 0?o.len:o.pos+i,a=new Rt.ipfs.pin.Set;o.pos<s;){var c=o.uint32();switch(c>>>3){case 1:a.version=o.uint32();break;case 2:a.fanout=o.uint32();break;case 3:a.seed=o.fixed32();break;default:o.skipType(c&7);break}}return a},r.fromObject=function(o){if(o instanceof Rt.ipfs.pin.Set)return o;var i=new Rt.ipfs.pin.Set;return o.version!=null&&(i.version=o.version>>>0),o.fanout!=null&&(i.fanout=o.fanout>>>0),o.seed!=null&&(i.seed=o.seed>>>0),i},r.toObject=function(o,i){i||(i={});var s={};return i.defaults&&(s.version=0,s.fanout=0,s.seed=0),o.version!=null&&o.hasOwnProperty("version")&&(s.version=o.version),o.fanout!=null&&o.hasOwnProperty("fanout")&&(s.fanout=o.fanout),o.seed!=null&&o.hasOwnProperty("seed")&&(s.seed=o.seed),s},r.prototype.toJSON=function(){return this.constructor.toObject(this,_e.default.util.toJSONOptions)},r}(),e}(),t})();var ts=ce(Pi()),Ht=ce(Zi());var st=new _("/local/pins"),Pt=256,Qi=8192,Lr=x.parse("QmdfTbBqBPQ7VNxZEYEj14VmRuZBkqFbiwReogJgS1zR1n"),Se={direct:"direct",recursive:"recursive"};function Or(t){return new _(`/${D.encode(t.multihash.bytes).toUpperCase().substring(1)}`)}function qt(t,e){e||(e=t.reduce((o,i)=>o+i.length,0));let r=new Uint8Array(e),n=0;for(let o of t)r.set(o,n),n+=o.length;return r}function es(t,e){for(let r=0;r<t.byteLength;r++){if(t[r]<e[r])return-1;if(t[r]>e[r])return 1}return t.byteLength>e.byteLength?1:t.byteLength<e.byteLength?-1:0}var Mr=zi.pin.Set;function Kc(t){let e=t.Data;if(!e)throw new Error("No data present");let r=Ht.default.decode(e),n=Ht.default.decode.bytes;if(n<=0)throw new Error("Invalid Set header length");if(n+r>e.length)throw new Error("Impossibly large set header length");let o=e.slice(n,r+n),i=Mr.toObject(Mr.decode(o),{defaults:!1,arrays:!0,longs:Number,objects:!1});if(i.version!==1)throw new Error(`Unsupported Set version: ${i.version}`);if(i.fanout>t.Links.length)throw new Error("Impossibly large fanout");return{header:i,data:e.slice(r+n)}}function Jc(t,e){let r=new Uint8Array(4);new DataView(r.buffer).setUint32(0,t,!0);let o=me(e.toString()),i=qt([r,o],r.byteLength+o.byteLength);return(0,ts.default)(pe(i))}async function*rs(t,e){let r=Kc(e),n=0;for(let o of e.Links){if(n<r.header.fanout){let i=o.Hash;if(!Lr.equals(i)){let s=await t.get(i),a=Ye(s);yield*rs(t,a)}}else yield o.Hash;n++}}async function*at(t,e,r){let n=e.Links.find(s=>s.Name===r);if(!n)throw new Error("No link found with name "+r);let o=await t.get(n.Hash),i=Ye(o);yield*rs(t,i)}function Yc(t,e){return r(e,0);async function r(n,o){let i=Mr.encode({version:1,fanout:Pt,seed:o}).finish(),s=Ht.default.encode(i.length),a=qt([s,i]),c=[];for(let u=0;u<Pt;u++)c.push({Name:"",Tsize:1,Hash:Lr});if(n.length<=Qi){let u=n.map(b=>({link:{Name:"",Tsize:1,Hash:b.key},data:b.data||new Uint8Array})).sort((b,w)=>es(b.link.Hash.bytes,w.link.Hash.bytes)),d=c.concat(u.map(b=>b.link));return{Data:qt([a,...u.map(b=>b.data)]),Links:d}}else{let u=n.reduce((m,b)=>{let w=Jc(o,b.key)%Pt;return m[w]=w in m?m[w].concat([b]):[b],m},[]),d=0;for(let m of u){let b=await r(m,o+1);await f(b,d),d++}return{Data:a,Links:c}}async function f(u,d){let m=Je(u),b=await Fe.digest(m),w=x.createV0(b);await t.put(w,m);let E=u.Links.reduce((S,T)=>S+(T.Tsize||0),0)+m.length;c[d]={Name:"",Tsize:E,Hash:w}}}}async function $r(t,e,r){let n=await Yc(t,r.map(c=>({key:c}))),o=Je(n),i=await Fe.digest(o),s=x.createV0(i);await t.put(s,o);let a=n.Links.reduce((c,f)=>c+f.Tsize,0)+o.length;return{Name:e,Tsize:a,Hash:s}}var Vt=ce(cr());async function Xc(t,e,r,n){if(!await e.has(st))return;let o=await e.get(st),i=x.decode(o),s=await t.get(i),a=Ye(s),c=0,f=await(0,Vt.default)(at(t,a,Se.recursive))+await(0,Vt.default)(at(t,a,Se.direct));for await(let u of at(t,a,Se.recursive)){c++;let d={depth:1/0};u.version!==0&&(d.version=u.version),u.code!==St&&(d.codec=u.code),await r.put(Or(u),Ut(d)),n(c/f*100,`Migrated recursive pin ${u}`)}for await(let u of at(t,a,Se.direct)){c++;let d={depth:0};u.version!==0&&(d.version=u.version),u.code!==St&&(d.codec=u.code),await r.put(Or(u),Ut(d)),n(c/f*100,`Migrated direct pin ${u}`)}await t.delete(i),await e.delete(st)}async function Zc(t,e,r,n){let o=[],i=[],s=0,a=await(0,Vt.default)(r.queryKeys({}));for await(let{key:m,value:b}of r.query({})){s++;let w=br(b),E=x.create(w.version||0,w.codec||St,Ie(D.decode("b"+m.toString().toLowerCase().split("/").pop())));w.depth===0?(n(s/a*100,`Reverted direct pin ${E}`),i.push(E)):(n(s/a*100,`Reverted recursive pin ${E}`),o.push(E))}n(100,"Updating pin root");let c={Links:[await $r(t,Se.direct,i),await $r(t,Se.recursive,o)]},f=Je(c),u=await Fe.digest(f),d=x.createV0(u);await t.put(d,f),await e.put(st,d.bytes)}async function ns(t,e,r){let n=t.blocks,o=t.datastore,i=t.pins;await n.open(),await o.open(),await i.open();try{await r(n,o,i,e)}finally{await i.close(),await o.close(),await n.close()}}var os={version:9,description:"Migrates pins to datastore",migrate:(t,e=()=>{})=>ns(t,e,Xc),revert:(t,e=()=>{})=>ns(t,e,Zc)};var cs=ce(as());function zr(t){return t=t||new Error("Not Found"),(0,cs.default)(t,"ERR_NOT_FOUND")}var us=new _("/config"),ct=new _("/version");function ut(t){let e=t;for(;e.db||e.child;)if(e=e.db||e.child,e.type==="level-js"||e.constructor.name==="Level")return e}async function eu(t,e,r){let n=await e(t);if(n)return n;let o=ut(r);return o?new Promise((i,s)=>{let a=o.store("readonly").get(t.toString());a.transaction.onabort=()=>{s(a.transaction.error)},a.transaction.oncomplete=()=>{i(Boolean(a.result))}}):!1}async function tu(t,e,r,n){if(await r(t))return e(t);let o=ut(n);if(!o)throw zr();return new Promise((i,s)=>{let a=o.store("readonly").get(t.toString());a.transaction.onabort=()=>{s(a.transaction.error)},a.transaction.oncomplete=()=>{if(a.result)return i(a.result);s(zr())}})}function Gt(t){let e=t.get.bind(t),r=t.has.bind(t);return t.get=n=>tu(n,e,r,t),t.has=n=>eu(n,r,t),t}function Rr(t){return{...t,root:Gt(t.root),datastore:Gt(t.datastore),pins:Gt(t.pins),keys:Gt(t.keys)}}async function ru(t,e,r=()=>{}){let n=ut(e);if(!n){r(`${t} did not need an upgrade`);return}r(`Upgrading ${t}`),await hs(n,(i,s)=>[{type:"del",key:i},{type:"put",key:me(i),value:s}])}async function nu(t,e,r=()=>{}){let n=ut(e);if(!n){r(`${t} did not need a downgrade`);return}r(`Downgrading ${t}`),await hs(n,(i,s)=>[{type:"del",key:i},{type:"put",key:pe(i),value:s}])}function fs(t){return t.child?fs(t.child):t}async function ls(t,e,r){let n=Object.entries(t).map(([s,a])=>({key:s,backend:fs(a)})).filter(({key:s,backend:a})=>a.constructor.name==="LevelDatastore").map(({key:s,backend:a})=>({name:s,store:a}));e(0,`Migrating ${n.length} dbs`);let o=0,i=s=>{e(Math.round(o/n.length*100),s)};for(let{name:s,store:a}of n){await a.open();try{await r(s,a,i)}finally{o++,await a.close()}}e(100,`Migrated ${n.length} dbs`)}var ds={version:10,description:"Migrates datastore-level keys to binary",migrate:(t,e=()=>{})=>ls(t,e,ru),revert:(t,e=()=>{})=>ls(t,e,nu)};function hs(t,e){function r(n,o){let i=t.store("readwrite"),s=i.transaction,a=0,c;s.onabort=()=>o(c||s.error||new Error("aborted by user")),s.oncomplete=()=>o();function f(){let u=n[a++],d=u.key,m;try{m=u.type==="del"?i.delete(d):i.put(u.value,d)}catch(b){c=b,s.abort();return}a<n.length&&(m.onsuccess=f)}f()}return new Promise((n,o)=>{let i=t.iterator(),s=c=>c;i._deserializeKey=i._deserializeValue=s,a();function a(){let c=(f,u,d)=>{if(f||u===void 0){let m=b=>{if(b){o(b);return}n()};i.end(m);return}r(e(u,d),a)};i.next(c)}})}var ve=new _("/local/filesroot");async function ou(t,e=()=>{}){if(e(100,"Migrating MFS root to repo datastore"),await t.root.open(),await t.datastore.open(),await t.root.has(ve)){let r=await t.root.get(ve);await t.datastore.put(ve,r),await t.root.delete(ve)}await t.datastore.close(),await t.root.close(),e(100,"Stored MFS root in repo datastore")}async function iu(t,e=()=>{}){if(e(100,"Migrating MFS root to repo root datastore"),await t.root.open(),await t.datastore.open(),await t.datastore.has(ve)){let r=await t.datastore.get(ve);await t.root.put(ve,r),await t.datastore.delete(ve)}await t.datastore.close(),await t.root.close(),e(100,"Stored MFS root in repo root datastore")}var ps={version:11,description:"Store mfs root in the datastore",migrate:ou,revert:iu};var Be={description:"Empty migration.",migrate:()=>{},revert:()=>{},empty:!0},ft=[Object.assign({version:1},Be),Object.assign({version:2},Be),Object.assign({version:3},Be),Object.assign({version:4},Be),Object.assign({version:5},Be),Object.assign({version:6},Be),Object.assign({version:7},Be),Bn,os,ds,ps];var ms=ce(At());var Pr={};M(Pr,{InvalidValueError:()=>ht,MissingRepoOptionsError:()=>de,NonReversibleMigrationError:()=>lt,NotInitializedRepoError:()=>Te,RequiredParameterError:()=>dt});var lt=class extends Error{constructor(e){super(e);this.name="NonReversibleMigrationError",this.code=lt.code,this.message=e}};lt.code="ERR_NON_REVERSIBLE_MIGRATION";var Te=class extends Error{constructor(e){super(e);this.name="NotInitializedRepoError",this.code=Te.code,this.message=e}};Te.code="ERR_NOT_INITIALIZED_REPO";var dt=class extends Error{constructor(e){super(e);this.name="RequiredParameterError",this.code=dt.code,this.message=e}};dt.code="ERR_REQUIRED_PARAMETER";var ht=class extends Error{constructor(e){super(e);this.name="InvalidValueError",this.code=ht.code,this.message=e}};ht.code="ERR_INVALID_VALUE";var de=class extends Error{constructor(e){super(e);this.name="MissingRepoOptionsError",this.code=de.code,this.message=e}};de.code="ERR_MISSING_REPO_OPTIONS";var qr=(0,ms.default)("ipfs:repo:migrator:repo:init");async function gs(t){if(!t)throw new de("Please pass repo options when trying to open a repo");let e=t.root;try{await e.open();let r=await e.has(ct),n=await e.has(us);return!r||!n?(qr(`Version entry present: ${r}`),qr(`Config entry present: ${n}`),!1):!0}catch(r){return qr("While checking if repo is initialized error was thrown: "+r.message),!1}finally{if(e!==void 0)try{await e.close()}catch{}}}async function Wt(t){if(!await gs(t))throw new Te("Repo is not initialized!");let e=t.root;await e.open();try{return parseInt(pe(await e.get(ct)))}finally{await e.close()}}async function pt(t,e){if(!e)throw new de("Please pass repo options when trying to open a repo");let r=e.root;await r.open(),await r.put(ct,me(String(t))),await r.close()}var ys=ce(At()),re=(0,ys.default)("ipfs:repo:migrator");function ws(t){return t=t||ft,!Array.isArray(t)||t.length===0?0:t[t.length-1].version}async function su(t,e,r,n,{ignoreLock:o=!1,onProgress:i,isDryRun:s=!1,migrations:a}){if(a=a||ft,!t)throw new H.RequiredParameterError("Path argument is required!");if(!r)throw new H.RequiredParameterError("repoOptions argument is required!");if(!n)throw new H.RequiredParameterError("toVersion argument is required!");if(!Number.isInteger(n)||n<=0)throw new H.InvalidValueError("Version has to be positive integer!");e=Rr(e);let c=await Wt(e);if(c===n){re("Nothing to migrate.");return}if(c>n)throw new H.InvalidValueError(`Current repo's version (${c}) is higher then toVersion (${n}), you probably wanted to revert it?`);bs(a,c,n);let f;!s&&!o&&(f=await r.repoLock.lock(t));try{for(let u of a){if(n!==void 0&&u.version>n)break;if(!(u.version<=c)){re(`Migrating version ${u.version}`);try{if(!s){let d=()=>{};i&&(d=(m,b)=>i(u.version,m.toFixed(2),b)),await u.migrate(e,d)}}catch(d){let m=u.version-1;throw re(`An exception was raised during execution of migration. Setting the repo's version to last successfully migrated version: ${m}`),await pt(m,e),new Error(`During migration to version ${u.version} exception was raised: ${d.stack||d.message||d}`)}re(`Migrating to version ${u.version} finished`)}}s||await pt(n||ws(a),e),re("Repo successfully migrated",n!==void 0?`to version ${n}!`:"to latest version!")}finally{!s&&!o&&f&&await f.close()}}async function au(t,e,r,n,{ignoreLock:o=!1,onProgress:i,isDryRun:s=!1,migrations:a}){if(a=a||ft,!t)throw new H.RequiredParameterError("Path argument is required!");if(!r)throw new H.RequiredParameterError("repoOptions argument is required!");if(!n)throw new H.RequiredParameterError("When reverting migrations, you have to specify to which version to revert!");if(!Number.isInteger(n)||n<=0)throw new H.InvalidValueError("Version has to be positive integer!");e=Rr(e);let c=await Wt(e);if(c===n){re("Nothing to revert.");return}if(c<n)throw new H.InvalidValueError(`Current repo's version (${c}) is lower then toVersion (${n}), you probably wanted to migrate it?`);bs(a,n,c,!0);let f;!s&&!o&&(f=await r.repoLock.lock(t)),re(`Reverting from version ${c} to ${n}`);try{let u=a.slice().reverse();for(let d of u){if(d.version<=n)break;if(!(d.version>c)){re(`Reverting migration version ${d.version}`);try{if(!s){let m=()=>{};i&&(m=(b,w)=>i(d.version,b.toFixed(2),w)),await d.revert(e,m)}}catch(m){let b=d.version;throw re(`An exception was raised during execution of migration. Setting the repo's version to last successfully reverted version: ${b}`),await pt(b,e),m.message=`During reversion to version ${d.version} exception was raised: ${m.message}`,m}re(`Reverting to version ${d.version} finished`)}}s||await pt(n,e),re(`All migrations successfully reverted to version ${n}!`)}finally{!s&&!o&&f&&await f.close()}}function bs(t,e,r,n=!1){let o=0;for(let i of t){if(i.version>r)break;if(i.version>e){if(n&&!i.revert)throw new H.NonReversibleMigrationError(`It is not possible to revert to version ${e} because migration version ${i.version} is not reversible. Cancelling reversion.`);o++}}if(o!==r-e)throw new H.InvalidValueError(`The ipfs-repo-migrations package does not have all migration to migrate from version ${e} to ${r}`)}var cu=Wt,H=Pr,uu=ft;return fu;})();
return IpfsRepoMigrations}));
