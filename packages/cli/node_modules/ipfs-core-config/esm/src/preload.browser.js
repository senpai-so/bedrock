import HTTP from 'ipfs-utils/src/http.js';
import debug from 'debug';
import PQueue from 'p-queue';
const log = Object.assign(debug('ipfs:preload'), { error: debug('ipfs:preload:error') });
const Queue = PQueue.default ? PQueue.default : PQueue;
const httpQueue = new Queue({ concurrency: 4 });
export function preload(url, options = {}) {
  log(url);
  return httpQueue.add(async () => {
    const res = await HTTP.post(url, { signal: options.signal });
    const reader = res.body.getReader();
    try {
      while (true) {
        const {done} = await reader.read();
        if (done)
          return;
      }
    } finally {
      reader.releaseLock();
    }
  });
}