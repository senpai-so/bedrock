import debug from 'debug';
import { createUnsafe } from 'multiformats/block';
const log = debug('ipfs:repo:utils:walk-dag');
export async function* walkDag(cid, blockstore, loadCodec, options) {
  try {
    const bytes = await blockstore.get(cid, options);
    const codec = await loadCodec(cid.code);
    const block = createUnsafe({
      bytes,
      cid,
      codec
    });
    for (const [, childCid] of block.links()) {
      yield childCid;
      yield* walkDag(childCid, blockstore, loadCodec, options);
    }
  } catch (err) {
    log('Could not walk DAG for CID', cid.toString(), err);
    throw err;
  }
}